<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. El Modelo &mdash; SED UNL  documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-2.3.2/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-2.3.2/css/bootstrap-responsive.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="top" title="SED UNL  documentation" href="../../index.html" />
    <link rel="next" title="4. Las plantillas" href="../Templates/templates.html" />
    <link rel="prev" title="2. Herramientas a Utilizar" href="../tools.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

<div style="background-color: #359B35; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../index.html"><img src="../../_static/logo.png" border="0" alt="unl"/></a>
</div>



  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="../../index.html">SED UNL</a>
        <span class="navbar-text pull-left"><b></b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a href="../../index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">1. Introducción</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools.html">2. Herramientas a Utilizar</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">3. El Modelo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Templates/templates.html">4. Las plantillas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Views/views.html">5. La vistas</a></li>
</ul>
</ul>
</li>
              <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">3. El Modelo</a><ul>
<li><a class="reference internal" href="#clase-configuracion">3.1. Clase Configuracion</a></li>
<li><a class="reference internal" href="#clase-ofertaacademicasga">3.2. Clase OfertaAcademicaSGA</a></li>
<li><a class="reference internal" href="#clase-periodoacademico">3.3. Clase PeriodoAcademico</a></li>
<li><a class="reference internal" href="#clase-asignatura">3.4. Clase Asignatura</a></li>
<li><a class="reference internal" href="#clase-estudianteperiodoacademico">3.5. Clase EstudiantePeriodoAcademico</a></li>
<li><a class="reference internal" href="#clase-estudianteasignaturadocente">3.6. Clase EstudianteAsignaturaDocente</a></li>
<li><a class="reference internal" href="#clase-asignaturadocente">3.7. Clase AsignaturaDocente</a></li>
<li><a class="reference internal" href="#clase-docenteperiodoacademico">3.8. Clase DocentePeriodoAcademico</a></li>
<li><a class="reference internal" href="#clase-direccioncarrera">3.9. Clase DireccionCarrera</a></li>
<li><a class="reference internal" href="#clase-tipoinformante">3.10. Clase TipoInformante</a></li>
<li><a class="reference internal" href="#clase-cuestionario">3.11. Clase Cuestionario</a></li>
<li><a class="reference internal" href="#clase-contestacion">3.12. Clase Contestacion</a></li>
<li><a class="reference internal" href="#clase-evaluacion">3.13. Clase Evaluacion</a></li>
<li><a class="reference internal" href="#clase-resultados">3.14. Clase Resultados</a></li>
<li><a class="reference internal" href="#clase-tipopregunta">3.15. Clase TipoPregunta</a></li>
<li><a class="reference internal" href="#clase-seleccionunica">3.16. Clase SeleccionUnica</a></li>
<li><a class="reference internal" href="#clase-ensayo">3.17. Clase Ensayo</a></li>
<li><a class="reference internal" href="#clase-seccion">3.18. Clase Seccion</a></li>
<li><a class="reference internal" href="#clase-pregunta">3.19. Clase Pregunta</a></li>
<li><a class="reference internal" href="#clase-itempregunta">3.20. Clase ItemPregunta</a></li>
<li><a class="reference internal" href="#clase-areasga">3.21. Clase AreaSGA</a></li>
<li><a class="reference internal" href="#clase-periodoevaluacion">3.22. Clase PeriodoEvaluacion</a></li>
<li><a class="reference internal" href="#clase-tabulacion">3.23. Clase Tabulacion</a></li>
<li><a class="reference internal" href="#clase-tabulacionevaluacion2013">3.24. Clase TabulacionEvaluacion2013</a></li>
<li><a class="reference internal" href="#clase-tabulacionadicionales2012">3.25. Clase TabulacionAdicionales2012</a></li>
<li><a class="reference internal" href="#clase-tabulacionsatisfaccion2012">3.26. Clase TabulacionSatisfaccion2012</a></li>
<li><a class="reference internal" href="#clase-usuario">3.27. Clase Usuario</a></li>
</ul>
</li>
</ul>
</ul>
</li>
            
            
              
  <li><a href="../tools.html"
         title="Previous Chapter: 2. Herramientas a Utilizar">&laquo; 2. Herramientas ...</a></li>
  <li><a href="../Templates/templates.html"
         title="Next Chapter: 4. Las plantillas">4. Las plantilla... &raquo;</a></li>
            
            
              <li>
  <a href="../../_sources/library/Models/models.txt"
     rel="nofollow">Source</a></li>
            
          </ul>

          
            
<form class="navbar-search pull-right" action="../../search.html" method="get">
  <input type="text" name="q" class="search-query" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  
  <div class="section" id="el-modelo">
<span id="models-title"></span><h1>3. El Modelo<a class="headerlink" href="#el-modelo" title="Permalink to this headline">¶</a></h1>
<div class="section" id="clase-configuracion">
<span id="class-configuracion"></span><h2>3.1. Clase Configuracion<a class="headerlink" href="#clase-configuracion" title="Permalink to this headline">¶</a></h2>
<p>Encargada de las configuraciones generales de la aplicacion.</p>
<p><strong>Descripción</strong>::
Se hace uso de la clase Models que se encuentra en django.db.models para construir un nuevo modelo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Para mas información consultar los <a class="reference external" href="https://docs.djangoproject.com/en/dev/topics/db/models/">Modelos</a> en Django</p>
</div>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p>
<blockquote>
<div><dl class="docutils">
<dt>class Configuracion(models.Model):</dt>
<dd><dl class="first docutils">
<dt>periodoAcademicoActual = models.OneToOneField(</dt>
<dd><dl class="first last docutils">
<dt>&#8216;PeriodoAcademico&#8217;,</dt>
<dd>null=True,
blank=True,
verbose_name=&#8217;Periodo Académico Actual&#8217;
)</dd>
</dl>
</dd>
<dt>periodoEvaluacionActual = models.OneToOneField(</dt>
<dd><p class="first">&#8216;PeriodoEvaluacion&#8217;,
null=True, blank=True,</p>
<blockquote class="last">
<div>verbose_name=&#8217;Periodo Evaluación Actual&#8217;
)</div></blockquote>
</dd>
</dl>
<p>&#64;classmethod
def getPeriodoAcademicoActual(self):</p>
<blockquote>
<div>return Configuracion.objects.get(id=1).periodoAcademicoActual</div></blockquote>
<p>&#64;classmethod
def getPeriodoEvaluacionActual(self):</p>
<blockquote>
<div>return Configuracion.objects.get(id=1).periodoEvaluacionActual</div></blockquote>
<dl class="last docutils">
<dt>class Meta:</dt>
<dd>verbose_name = u&#8217;Configuraciones&#8217;
verbose_name_plural = u&#8217;Configuraciones&#8217;</dd>
<dt>def __unicode__(self):</dt>
<dd>return u&#8221;Configuraciones de la Aplicación&#8221;</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="clase-ofertaacademicasga">
<span id="class-ofertaacademicasga"></span><h2>3.2. Clase OfertaAcademicaSGA<a class="headerlink" href="#clase-ofertaacademicasga" title="Permalink to this headline">¶</a></h2>
<p>Codigo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">OfertaAcademicaSGA</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">idSGA</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">&#39;Id_SGA&#39;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">db_column</span><span class="o">=</span><span class="s">&#39;id_sga&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">descripcion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;100&#39;</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">&#39;Descripción&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">u&#39;Oferta Académica&#39;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">u&#39;Ofertas Académicas&#39;</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">descripcion</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-periodoacademico">
<span id="class-periodoacademico"></span><h2>3.3. Clase PeriodoAcademico<a class="headerlink" href="#clase-periodoacademico" title="Permalink to this headline">¶</a></h2>
<p>Codigo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PeriodoAcademico</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;50&#39;</span><span class="p">)</span>
    <span class="n">inicio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">fin</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">periodoLectivo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">db_column</span><span class="o">=</span><span class="s">&#39;periodo_lectivo&#39;</span><span class="p">)</span>
    <span class="n">ofertasAcademicasSGA</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s">&#39;OfertaAcademicaSGA&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;peridosAcademicos&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">&#39;Ofertas SGA&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cargarOfertasSGA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">SGA</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">SGAWS_USER</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">SGAWS_PASS</span><span class="p">)</span>
        <span class="n">ofertas_dict</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">ofertas_academicas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inicio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fin</span><span class="p">)</span>
        <span class="n">ofertas</span> <span class="o">=</span> <span class="p">[</span><span class="n">OfertaAcademicaSGA</span><span class="p">(</span><span class="n">idSGA</span><span class="o">=</span><span class="n">oa</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">descripcion</span><span class="o">=</span><span class="n">oa</span><span class="p">[</span><span class="s">&#39;descripcion&#39;</span><span class="p">])</span>  <span class="k">for</span> <span class="n">oa</span> <span class="ow">in</span> <span class="n">ofertas_dict</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">oa</span> <span class="ow">in</span> <span class="n">ofertas</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">OfertaAcademicaSGA</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">idSGA</span><span class="o">=</span><span class="n">oa</span><span class="o">.</span><span class="n">idSGA</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">OfertaAcademicaSGA</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                <span class="c"># Se agregan solo en el caso que no existan aún la oferta académica</span>
                <span class="n">oa</span><span class="o">.</span><span class="n">periodoAcademico</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="n">oa</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           Cada vez que se crea un nuevo Periodo Académico se consultan las ofertas academicas del SGA para adherirlas.</span>
<span class="sd">           Luego se pueden eliminar desde la aplicación de administración.</span>
<span class="sd">           @author: Milton Labanda</span>
<span class="sd">           @date: 04-05-2012</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nuevo</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
            <span class="n">nuevo</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PeriodoAcademico</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nuevo</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cargarOfertasSGA</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">logg</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Error al cargar ofertas academicas del SGA: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;inicio&#39;</span><span class="p">]</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">u&#39;Periodo Académico&#39;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">u&#39;Periodos Académicos&#39;</span>

    <span class="k">def</span> <span class="nf">rango</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;{0} / {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inicio</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b %Y&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fin</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%b %Y&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nombre</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-asignatura">
<span id="class-asignatura"></span><h2>3.4. Clase Asignatura<a class="headerlink" href="#clase-asignatura" title="Permalink to this headline">¶</a></h2>
<p>Codigo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Asignatura</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;20&#39;</span><span class="p">)</span>
    <span class="n">carrera</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;100&#39;</span><span class="p">)</span>
    <span class="n">semestre</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">u&#39;módulo&#39;</span><span class="p">)</span>
    <span class="n">paralelo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;50&#39;</span><span class="p">)</span>
    <span class="n">seccion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">)</span>
    <span class="n">modalidad</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;20&#39;</span><span class="p">)</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">tipo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;15&#39;</span><span class="p">)</span>
    <span class="n">creditos</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">u&#39;número de créditos&#39;</span><span class="p">)</span>
    <span class="n">duracion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">u&#39;duración en horas&#39;</span><span class="p">)</span>
    <span class="n">inicio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">&#39;inicia&#39;</span><span class="p">)</span>
    <span class="n">fin</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">&#39;termina&#39;</span><span class="p">)</span>
    <span class="c"># Campo combinado id_unidad:id_paralelo</span>
    <span class="n">idSGA</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;15&#39;</span><span class="p">,</span> <span class="n">db_column</span><span class="o">=</span><span class="s">&#39;id_sga&#39;</span><span class="p">)</span>
    <span class="n">periodoAcademico</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;PeriodoAcademico&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;asignaturas&#39;</span><span class="p">,</span>
                                         <span class="n">verbose_name</span><span class="o">=</span><span class="s">u&#39;Periodo Académico&#39;</span><span class="p">,</span> <span class="n">db_column</span><span class="o">=</span><span class="s">&#39;periodo_academico_id&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">esVigente</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Determina si la asignatura se dicta dentro del Periodo de Evaluación Actual &quot;&quot;&quot;</span>
        <span class="n">periodoEvaluacion</span> <span class="o">=</span> <span class="n">Configuracion</span><span class="o">.</span><span class="n">getPeriodoEvaluacionActual</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inicio</span> <span class="o">&lt;=</span> <span class="n">periodoEvaluacion</span><span class="o">.</span><span class="n">fin</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fin</span> <span class="o">&gt;=</span> <span class="n">periodoEvaluacion</span><span class="o">.</span><span class="n">inicio</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">getTipo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tipos</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&#39;taller&#39;</span><span class="p">,</span><span class="s">u&#39;curso&#39;</span><span class="p">,</span><span class="s">u&#39;módulo&#39;</span><span class="p">,</span><span class="s">u&#39;modulo&#39;</span><span class="p">,</span><span class="s">u&#39;unidad&#39;</span><span class="p">]</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tipos</span> <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nombre</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="k">if</span> <span class="n">l</span> <span class="k">else</span> <span class="s">u&#39;otro&#39;</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tipo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTipo</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Asignatura</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;{0} - {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idSGA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-estudianteperiodoacademico">
<span id="class-estudianteperiodoacademico"></span><h2>3.5. Clase EstudiantePeriodoAcademico<a class="headerlink" href="#clase-estudianteperiodoacademico" title="Permalink to this headline">¶</a></h2>
<p>Codigo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">EstudiantePeriodoAcademico</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;Usuario&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;estudiantePeriodosAcademicos&#39;</span><span class="p">)</span>
    <span class="n">periodoAcademico</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;PeriodoAcademico&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;estudiantes&#39;</span><span class="p">,</span>
                                         <span class="n">verbose_name</span><span class="o">=</span><span class="s">&#39;Periodo Académico&#39;</span><span class="p">,</span> <span class="n">db_column</span><span class="o">=</span><span class="s">&#39;periodo_academico_id&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">&#39;Estudiante&#39;</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;usuario&#39;</span><span class="p">,</span> <span class="s">&#39;periodoAcademico&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cedula</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">usuario</span><span class="o">.</span><span class="n">cedula</span>

    <span class="k">def</span> <span class="nf">paralelos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">consulta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asignaturasDocentesEstudiante</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;asignaturaDocente__asignatura__area&#39;</span><span class="p">,</span>
                                                                  <span class="s">&#39;asignaturaDocente__asignatura__carrera&#39;</span><span class="p">,</span>
                                                                  <span class="s">&#39;asignaturaDocente__asignatura__semestre&#39;</span><span class="p">,</span>
                                                                  <span class="s">&#39;asignaturaDocente__asignatura__paralelo&#39;</span><span class="p">,</span>
                                                                  <span class="s">&#39;asignaturaDocente__asignatura__seccion&#39;</span><span class="p">,)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
        <span class="c"># Se construye una lista de diccionarios</span>
        <span class="n">datos</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">((</span><span class="s">&#39;area&#39;</span><span class="p">,</span><span class="s">&#39;carrera&#39;</span><span class="p">,</span><span class="s">&#39;modulo&#39;</span><span class="p">,</span><span class="s">&#39;paralelo&#39;</span><span class="p">,</span><span class="s">&#39;seccion&#39;</span><span class="p">),</span><span class="n">r</span><span class="p">))</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">consulta</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">datos</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">usuario</span><span class="o">.</span><span class="n">get_full_name</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-estudianteasignaturadocente">
<span id="class-estudianteasignaturadocente"></span><h2>3.6. Clase EstudianteAsignaturaDocente<a class="headerlink" href="#clase-estudianteasignaturadocente" title="Permalink to this headline">¶</a></h2>
<p>Codigo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">EstudianteAsignaturaDocente</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">estudiante</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;EstudiantePeriodoAcademico&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;asignaturasDocentesEstudiante&#39;</span><span class="p">)</span>
    <span class="n">asignaturaDocente</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;AsignaturaDocente&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;estudiantesAsignaturaDocente&#39;</span><span class="p">,</span>
                                          <span class="n">verbose_name</span><span class="o">=</span><span class="s">&#39;Asignatura - Docente&#39;</span><span class="p">)</span>
    <span class="n">matricula</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">estado</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;60&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asignaturaDocente</span><span class="o">.</span><span class="n">asignatura</span><span class="o">.</span><span class="n">area</span>
    <span class="n">get_area</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s">&#39;Area&#39;</span>

    <span class="k">def</span> <span class="nf">get_carrera</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asignaturaDocente</span><span class="o">.</span><span class="n">asignatura</span><span class="o">.</span><span class="n">carrera</span><span class="p">[:</span><span class="mi">60</span><span class="p">]</span>
    <span class="n">get_carrera</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s">&#39;Carrera&#39;</span>

    <span class="k">def</span> <span class="nf">get_semestre</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asignaturaDocente</span><span class="o">.</span><span class="n">asignatura</span><span class="o">.</span><span class="n">semestre</span>
    <span class="n">get_semestre</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s">&#39;Semestre&#39;</span>

    <span class="k">def</span> <span class="nf">get_paralelo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asignaturaDocente</span><span class="o">.</span><span class="n">asignatura</span><span class="o">.</span><span class="n">paralelo</span>
    <span class="n">get_paralelo</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s">&#39;Paralelo&#39;</span>

    <span class="k">def</span> <span class="nf">get_nombre_corto</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unicode__</span><span class="p">()[:</span><span class="mi">60</span><span class="p">]</span>
    <span class="n">get_nombre_corto</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s">&#39;Nombre&#39;</span>

    <span class="k">def</span> <span class="nf">get_asignatura</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asignaturaDocente</span><span class="o">.</span><span class="n">asignatura</span>

    <span class="c"># Campos para adicionar en el Admin a través del formulario  EstudianteAsignaturaDocenteAdminForm</span>
    <span class="n">carrera</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_carrera</span><span class="p">,)</span>
    <span class="n">semestre</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_semestre</span><span class="p">,)</span>
    <span class="n">paralelo</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_paralelo</span><span class="p">,)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">&#39;Estudiante Asignaturas&#39;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">&#39;Estudiantes y Asignaturas&#39;</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;estudiante&#39;</span><span class="p">,</span><span class="s">&#39;asignaturaDocente&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;{0} &gt;&gt; {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estudiante</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">asignaturaDocente</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-asignaturadocente">
<span id="class-asignaturadocente"></span><h2>3.7. Clase AsignaturaDocente<a class="headerlink" href="#clase-asignaturadocente" title="Permalink to this headline">¶</a></h2>
<p>Codigo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AsignaturaDocente</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">asignatura</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;Asignatura&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;docentesAsignatura&#39;</span><span class="p">)</span>
    <span class="n">docente</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;DocentePeriodoAcademico&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;asignaturasDocente&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_idSGA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asignatura</span><span class="o">.</span><span class="n">idSGA</span>

    <span class="k">def</span> <span class="nf">get_carrera</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asignatura</span><span class="o">.</span><span class="n">carrera</span><span class="p">[:</span><span class="mi">60</span><span class="p">]</span>
    <span class="n">get_carrera</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s">&#39;Carrera&#39;</span>

    <span class="k">def</span> <span class="nf">get_semestre</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asignatura</span><span class="o">.</span><span class="n">semestre</span>
    <span class="n">get_semestre</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s">&#39;Semestre&#39;</span>

    <span class="k">def</span> <span class="nf">get_paralelo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asignatura</span><span class="o">.</span><span class="n">paralelo</span>
    <span class="n">get_paralelo</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s">&#39;Paralelo&#39;</span>

    <span class="k">def</span> <span class="nf">get_nombre_corto</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ancho</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unicode__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">[:</span><span class="n">ancho</span><span class="p">]</span>
    <span class="n">get_nombre_corto</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s">&#39;Nombre&#39;</span>

    <span class="c"># Campos para adicionar en el Admin a través del formulario  EstudianteAsignaturaDocenteAdminForm</span>
    <span class="n">carrera</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_carrera</span><span class="p">,)</span>
    <span class="n">semestre</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_semestre</span><span class="p">,)</span>
    <span class="n">paralelo</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_paralelo</span><span class="p">,)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">&#39;Asignatura Docente&#39;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">&#39;Asignaturas y Docentes&#39;</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;docente&#39;</span><span class="p">,</span><span class="s">&#39;asignatura&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;{0} &gt;&gt; {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docente</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">asignatura</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span>


<span class="c"># Todas las carreras</span>
<span class="n">carreras</span> <span class="o">=</span> <span class="n">Asignatura</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;carrera&#39;</span><span class="p">,</span> <span class="s">&#39;carrera&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;carrera&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>

<span class="c">#carreras =((&#39;administracion&#39;,&#39;Administracion&#39;),(&#39;sistemas&#39;,&#39;Sistemas&#39;))</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-docenteperiodoacademico">
<span id="class-docenteperiodoacademico"></span><h2>3.8. Clase DocentePeriodoAcademico<a class="headerlink" href="#clase-docenteperiodoacademico" title="Permalink to this headline">¶</a></h2>
<p>Codigo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Todas las carreras</span>
<span class="n">carreras</span> <span class="o">=</span> <span class="n">Asignatura</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;carrera&#39;</span><span class="p">,</span> <span class="s">&#39;carrera&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;carrera&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>

<span class="c">#carreras =((&#39;administracion&#39;,&#39;Administracion&#39;),(&#39;sistemas&#39;,&#39;Sistemas&#39;))</span>

<span class="k">class</span> <span class="nc">DocentePeriodoAcademico</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">usuario</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;Usuario&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;docentePeriodosAcademicos&#39;</span><span class="p">)</span>
    <span class="n">periodoAcademico</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;PeriodoAcademico&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;docentes&#39;</span><span class="p">,</span>
                                         <span class="n">verbose_name</span><span class="o">=</span><span class="s">u&#39;Periodo Académico&#39;</span><span class="p">,</span> <span class="n">db_column</span><span class="o">=</span><span class="s">&#39;periodo_academico_id&#39;</span><span class="p">)</span>
    <span class="c"># Atributo agregado por efectos de migracion de docentes sin informacion de asignaturas</span>
    <span class="n">carrera</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;500&#39;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">carreras</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># Pertenece a la Comision Academica de la Carrera?</span>
    <span class="n">parAcademico</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">&#39;Docente&#39;</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;usuario&#39;</span><span class="p">,</span><span class="s">&#39;periodoAcademico&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_carreras_areas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Devuelve una lista de tuplas (carrera, area) pero unicamente del PeriodoAcademicoActual &quot;&quot;&quot;</span>
        <span class="n">lista_carreras_areas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lista_carreras_areas_query</span>  <span class="o">=</span> <span class="n">AsignaturaDocente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">docente__periodoAcademico</span><span class="o">=</span><span class="n">Configuracion</span><span class="o">.</span><span class="n">getPeriodoAcademicoActual</span><span class="p">(),</span>
            <span class="n">docente__id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;asignatura__carrera&#39;</span><span class="p">,</span> <span class="s">&#39;asignatura__area&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
        <span class="n">lista_carreras_areas</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lista_carreras_areas_query</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">carrera</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">carrera</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lista_carreras_areas_query</span><span class="p">]:</span>
            <span class="n">lista_carreras_areas</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">carrera</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">lista_carreras_areas</span>

    <span class="k">def</span> <span class="nf">get_carreras</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_carreras_areas</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">get_areas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_carreras_areas</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">paralelos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asignaturasDocente</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;asignatura__area&#39;</span><span class="p">,</span> <span class="s">&#39;asignatura__carrera&#39;</span><span class="p">,</span>
                                            <span class="s">&#39;asignatura__semestre&#39;</span><span class="p">,</span><span class="s">&#39;asignatura__paralelo&#39;</span><span class="p">,</span>
                                            <span class="s">&#39;asignatura__seccion&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
        <span class="n">datos</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">((</span><span class="s">&#39;area&#39;</span><span class="p">,</span><span class="s">&#39;carrera&#39;</span><span class="p">,</span><span class="s">&#39;modulo&#39;</span><span class="p">,</span><span class="s">&#39;paralelo&#39;</span><span class="p">,</span><span class="s">&#39;seccion&#39;</span><span class="p">),</span><span class="n">r</span><span class="p">))</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">datos</span>


    <span class="k">def</span> <span class="nf">cedula</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">usuario</span><span class="o">.</span><span class="n">cedula</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&#39;{0} {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usuario</span><span class="o">.</span><span class="n">abreviatura</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usuario</span><span class="o">.</span><span class="n">get_full_name</span><span class="p">())</span>
</pre></div>
</div>
<p>Codigo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Todas las carrera que riguen en el Periodo Académico Actual</span>
<span class="n">carreras_areas</span> <span class="o">=</span> <span class="n">AsignaturaDocente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="n">docente__periodoAcademico</span><span class="o">=</span><span class="n">Configuracion</span><span class="o">.</span><span class="n">getPeriodoAcademicoActual</span><span class="p">())</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span>
    <span class="s">&#39;asignatura__carrera&#39;</span><span class="p">,</span> <span class="s">&#39;asignatura__area&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span>
    <span class="s">&#39;asignatura__carrera&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
<span class="n">carreras_areas</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="s">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span>  <span class="n">carreras_areas</span><span class="p">]</span>
<span class="c">#carreras_areas = ((&#39;energia&#39;,&#39;Energia&#39;),(&#39;medicina&#39;,&#39;Medicina&#39;))</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-direccioncarrera">
<span id="class-direccioncarrera"></span><h2>3.9. Clase DireccionCarrera<a class="headerlink" href="#clase-direccioncarrera" title="Permalink to this headline">¶</a></h2>
<p>Codigo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">DireccionCarrera</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># Nombre de la Carrera más el Área</span>
    <span class="n">carrera</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">carreras_areas</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                               <span class="n">verbose_name</span><span class="o">=</span><span class="s">u&#39;Carrera-Area&#39;</span><span class="p">)</span>
    <span class="c"># Director o Coordinador de Carrera</span>
    <span class="n">director</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;DocentePeriodoAcademico&#39;</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">u&quot;Coordinador&quot;</span><span class="p">,</span>
                                 <span class="n">related_name</span><span class="o">=</span><span class="s">&quot;direcciones&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;Coordinación {0} - {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carrera</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">periodoAcademico</span><span class="o">.</span><span class="n">rango</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_docentes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># separa carrera y area</span>
        <span class="n">ids_docentes</span> <span class="o">=</span> <span class="n">AsignaturaDocente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">asignatura__carrera</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">carrera</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">asignatura__area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">carrera</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;docente__id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
        <span class="n">docentes</span> <span class="o">=</span> <span class="n">DocentePeriodoAcademico</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">periodoAcademico</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">periodoAcademico</span><span class="p">,</span> <span class="n">id__in</span><span class="o">=</span><span class="n">ids_docentes</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span>
            <span class="s">&#39;usuario__last_name&#39;</span><span class="p">,</span> <span class="s">&#39;usuario__first_name&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">docentes</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;carrera&#39;</span><span class="p">]</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">u&#39;Coordinación de Carrera&#39;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">&#39;Coordinaciones de Carreras&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-tipoinformante">
<span id="class-tipoinformante"></span><h2>3.10. Clase TipoInformante<a class="headerlink" href="#clase-tipoinformante" title="Permalink to this headline">¶</a></h2>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TipoInformante</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">tipo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;50&#39;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">descripcion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;200&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipo</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;descripcion&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-cuestionario">
<span id="class-cuestionario"></span><h2>3.11. Clase Cuestionario<a class="headerlink" href="#clase-cuestionario" title="Permalink to this headline">¶</a></h2>
<p>Codigo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Cuestionario</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># Nombre corto para identificacion de objeto</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;150&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;Cuestionario Sin Nombre&#39;</span><span class="p">)</span>
    <span class="n">titulo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;255&#39;</span><span class="p">)</span>
    <span class="n">encabezado</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">inicio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="s">u&#39;Inicio de la Encuesta&#39;</span><span class="p">)</span>
    <span class="n">fin</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="s">u&#39;Finalización de la Encuesta&#39;</span><span class="p">)</span>
    <span class="c"># Obligatoriedad de todas las preguntas del cuestionario</span>
    <span class="n">preguntas_obligatorias</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">informante</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">TipoInformante</span><span class="p">)</span>
    <span class="c"># Generalmente de acuerdo al Tipo de Informante</span>
    <span class="n">peso</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">periodoEvaluacion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;PeriodoEvaluacion&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                          <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;cuestionarios&#39;</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">u&#39;Periodo de Evaluación&#39;</span>
                                          <span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_preguntas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Obtiene todas las preguntas de todas las secciones y subsecciones &quot;&quot;&quot;</span>
        <span class="n">preguntas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">secciones</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">preguntas</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">get_preguntas</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">preguntas</span>

    <span class="k">def</span> <span class="nf">clonar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Crea una copia de un cuestionario incluyendo todas sus secciones y todas sus</span>
<span class="sd">        preguntas. Teniendo en cuenta que todos los objetos involucrados seran objetos</span>
<span class="sd">        nuevos.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numero</span> <span class="o">=</span> <span class="n">Cuestionario</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">nuevo</span> <span class="o">=</span> <span class="n">Cuestionario</span><span class="p">()</span>
        <span class="n">nuevo</span><span class="o">.</span><span class="n">titulo</span> <span class="o">=</span> <span class="s">u&#39;{0} (Clonado {1})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">titulo</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">numero</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">nuevo</span><span class="o">.</span><span class="n">encabezado</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encabezado</span>
        <span class="n">nuevo</span><span class="o">.</span><span class="n">inicio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inicio</span>
        <span class="n">nuevo</span><span class="o">.</span><span class="n">fin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fin</span>
        <span class="c"># No se relacionan para mayor flexibilidad</span>
        <span class="n">nuevo</span><span class="o">.</span><span class="n">informante</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">nuevo</span><span class="o">.</span><span class="n">periodoEvaluacion</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">nuevo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">seccion</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">secciones</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">nuevaSeccion</span> <span class="o">=</span> <span class="n">Seccion</span><span class="p">()</span>
            <span class="n">nuevaSeccion</span><span class="o">.</span><span class="n">titulo</span> <span class="o">=</span> <span class="n">seccion</span><span class="o">.</span><span class="n">titulo</span>
            <span class="n">nuevaSeccion</span><span class="o">.</span><span class="n">descripcion</span> <span class="o">=</span> <span class="n">seccion</span><span class="o">.</span><span class="n">descripcion</span>
            <span class="n">nuevaSeccion</span><span class="o">.</span><span class="n">orden</span> <span class="o">=</span> <span class="n">seccion</span><span class="o">.</span><span class="n">orden</span>
            <span class="n">nuevaSeccion</span><span class="o">.</span><span class="n">seccionPadre</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">nuevaSeccion</span><span class="o">.</span><span class="n">cuestionario</span> <span class="o">=</span> <span class="n">nuevo</span>
            <span class="n">nuevaSeccion</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">pregunta</span> <span class="ow">in</span> <span class="n">seccion</span><span class="o">.</span><span class="n">preguntas</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">nuevaPregunta</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="p">()</span>
                <span class="n">nuevaPregunta</span><span class="o">.</span><span class="n">texto</span> <span class="o">=</span> <span class="n">pregunta</span><span class="o">.</span><span class="n">texto</span>
                <span class="n">nuevaPregunta</span><span class="o">.</span><span class="n">orden</span> <span class="o">=</span> <span class="n">pregunta</span><span class="o">.</span><span class="n">orden</span>
                <span class="n">nuevaPregunta</span><span class="o">.</span><span class="n">tipo</span> <span class="o">=</span> <span class="n">pregunta</span><span class="o">.</span><span class="n">tipo</span>
                <span class="n">nuevaPregunta</span><span class="o">.</span><span class="n">seccion</span> <span class="o">=</span> <span class="n">nuevaSeccion</span>
                <span class="n">nuevaPregunta</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">pregunta</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">nuevoItem</span> <span class="o">=</span> <span class="n">ItemPregunta</span><span class="p">()</span>
                    <span class="n">nuevoItem</span><span class="o">.</span><span class="n">texto</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">texto</span>
                    <span class="n">nuevoItem</span><span class="o">.</span><span class="n">orden</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">orden</span>
                    <span class="n">nuevoItem</span><span class="o">.</span><span class="n">pregunta</span> <span class="o">=</span> <span class="n">nuevaPregunta</span>
                    <span class="n">nuevoItem</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">nuevo</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nombre</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-contestacion">
<span id="class-contestacion"></span><h2>3.12. Clase Contestacion<a class="headerlink" href="#clase-contestacion" title="Permalink to this headline">¶</a></h2>
<p>Codigo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Contestacion</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">pregunta</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">respuesta</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="c"># Adicionales a la respuesta propiamente establecida</span>
    <span class="n">observaciones</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">evaluacion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;Evaluacion&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;contestaciones&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_pregunta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Devuelve el objeto &#39;pregunta&#39; a partir del atributo id_pregunta &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pregunta</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">&#39;Respuesta&#39;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">&#39;Respuestas&#39;</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&#39;{0}:{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pregunta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">respuesta</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-evaluacion">
<span id="class-evaluacion"></span><h2>3.13. Clase Evaluacion<a class="headerlink" href="#clase-evaluacion" title="Permalink to this headline">¶</a></h2>
<p>Codigo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Evaluacion</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delega la lógica que determina el tipo de evaluación a los controladores</span>
<span class="sd">    Se puede acceder a las evaluaciones y autoevaluaciones directamente</span>
<span class="sd">    Para acceder a las evaluaciones de los estudiantes utilizar &#39;estudianteAsignaturaDocente&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fechaInicio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">fechaFin</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">horaInicio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TimeField</span><span class="p">()</span>
    <span class="n">horaFin</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TimeField</span><span class="p">()</span>
    <span class="n">cuestionario</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;Cuestionario&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;evaluaciones&#39;</span><span class="p">)</span>
    <span class="c"># Evaluaciones de ESTUDIANTES</span>
    <span class="n">estudianteAsignaturaDocente</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;EstudianteAsignaturaDocente&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;evaluaciones&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="c"># Evaluaciones de DOCENTES. Pueden ser evaluaciones y autoevaluaciones</span>
    <span class="n">docentePeriodoAcademico</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;DocentePeriodoAcademico&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;evaluaciones&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># Evaluaciones de PARES ACADEMICOS # Docente Par Academico</span>
    <span class="n">parAcademico</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;DocentePeriodoAcademico&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;evaluaciones_par_academico&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># Evaluaciones de DIRECCIONES DE CARRERA # Docente Director</span>
    <span class="n">directorCarrera</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;DocentePeriodoAcademico&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;evaluaciones_director&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># Evaluaciones de DIRECCIONES DE CARRERA # Nombre de la Carrera mas el Area</span>
    <span class="n">carreraDirector</span> <span class="o">=</span>  <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">carreras_areas</span><span class="p">,</span>
                                        <span class="n">verbose_name</span><span class="o">=</span><span class="s">u&#39;Carrera-Area&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">evaluador</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Evaluacion del Estudiante a sus docentes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estudianteAsignaturaDocente</span><span class="p">:</span>
            <span class="n">evaluador</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estudianteAsignaturaDocente</span><span class="o">.</span><span class="n">estudiante</span>
        <span class="c"># Evaluacion del Director de Carrera</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">directorCarrera</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">docentePeriodoAcademico</span><span class="p">:</span>
            <span class="n">evaluador</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directorCarrera</span>
        <span class="c"># Evaluacion del Par Academico de la Carrera</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parAcademico</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">docentePeriodoAcademico</span><span class="p">:</span>
            <span class="n">evaluador</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parAcademico</span>
        <span class="c"># Autoevaluacion del docente</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">docentePeriodoAcademico</span><span class="p">:</span>
            <span class="n">evaluador</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docentePeriodoAcademico</span>
        <span class="k">return</span> <span class="n">evaluador</span>

    <span class="k">def</span> <span class="nf">evaluado</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Evaluacion del Estudiante a sus docentes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estudianteAsignaturaDocente</span><span class="p">:</span>
            <span class="n">evaluado</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estudianteAsignaturaDocente</span><span class="o">.</span><span class="n">asignaturaDocente</span><span class="o">.</span><span class="n">docente</span>
        <span class="c"># Evaluacion del Director de la Carrera al docente</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">directorCarrera</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">docentePeriodoAcademico</span><span class="p">:</span>
            <span class="n">evaluado</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docentePeriodoAcademico</span>
        <span class="c"># Evaluacion del Par Academico de la Carrera al docente</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parAcademico</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">docentePeriodoAcademico</span><span class="p">:</span>
            <span class="n">evaluado</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docentePeriodoAcademico</span>
        <span class="c"># Autoevaluacion del docente</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">docentePeriodoAcademico</span><span class="p">:</span>
            <span class="n">evaluado</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docentePeriodoAcademico</span>
        <span class="k">return</span> <span class="n">evaluado</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">&#39;Evaluaciones&#39;</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&#39;{0} - {1} - {2}|{3} - {4}|{5} - {6}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluador</span><span class="p">()</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">cedula</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluador</span><span class="p">(),</span> <span class="n">DireccionCarrera</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluador</span><span class="p">()</span><span class="o">.</span><span class="n">cedula</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluado</span><span class="p">()</span><span class="o">.</span><span class="n">cedula</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fechaInicio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">horaInicio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fechaFin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">horaFin</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cuestionario</span><span class="o">.</span><span class="n">informante</span>
            <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-resultados">
<span id="class-resultados"></span><h2>3.14. Clase Resultados<a class="headerlink" href="#clase-resultados" title="Permalink to this headline">¶</a></h2>
<p>Codigo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Resultados</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clase para forzar un enlace desde al admin de la app</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">&#39;Resultados&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-tipopregunta">
<span id="class-tipopregunta"></span><h2>3.15. Clase TipoPregunta<a class="headerlink" href="#clase-tipopregunta" title="Permalink to this headline">¶</a></h2>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TipoPregunta</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># TODO: Clase Abstracta</span>
    <span class="n">tipo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;20&#39;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">descripcion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;100&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipo</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-seleccionunica">
<span id="class-seleccionunica"></span><h2>3.16. Clase SeleccionUnica<a class="headerlink" href="#clase-seleccionunica" title="Permalink to this headline">¶</a></h2>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SeleccionUnica</span><span class="p">(</span><span class="n">TipoPregunta</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">TipoPregunta</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tipo</span> <span class="o">=</span> <span class="s">&#39;SeleccionUnica&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descripcion</span> <span class="o">=</span> <span class="s">&#39;Se visualiza  radio buttons&#39;</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&#39;Selección Única&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-ensayo">
<span id="class-ensayo"></span><h2>3.17. Clase Ensayo<a class="headerlink" href="#clase-ensayo" title="Permalink to this headline">¶</a></h2>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Ensayo</span><span class="p">(</span><span class="n">TipoPregunta</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">TipoPregunta</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tipo</span> <span class="o">=</span> <span class="s">&#39;Ensayo&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descripcion</span> <span class="o">=</span> <span class="s">&#39;Se visualiza con un area de texto&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-seccion">
<span id="class-seccion"></span><h2>3.18. Clase Seccion<a class="headerlink" href="#clase-seccion" title="Permalink to this headline">¶</a></h2>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Seccion</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># Nombre corto para identificacion de objeto</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;150&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">u&#39;Sección de Cuestionario Sin Nombre&#39;</span><span class="p">)</span>
    <span class="n">titulo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;200&#39;</span><span class="p">)</span>
    <span class="n">descripcion</span>  <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">orden</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">codigo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;20&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ponderacion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># Una subseccion esta relacionada con otra Seccion en vez de un Cuestionario</span>
    <span class="n">superseccion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;self&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">db_column</span><span class="o">=</span><span class="s">&#39;superseccion_id&#39;</span><span class="p">,</span>
                                     <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;subsecciones&#39;</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">u&#39;Sección Padre&#39;</span><span class="p">)</span>
    <span class="c"># Una seccion normalmente esta relacionada con un Cuestionario</span>
    <span class="n">cuestionario</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Cuestionario</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;secciones&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_cuestionario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Metodo recursivo hasta llegar a la seccion padre que tiene Cuestionario &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">superseccion</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">superseccion</span><span class="o">.</span><span class="n">get_cuestionario</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cuestionario</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cuestionario</span>

    <span class="k">def</span> <span class="nf">get_preguntas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Metodo recursivo hasta llegar a las secciones que no tiene subsecciones  &quot;&quot;&quot;</span>
        <span class="n">preguntas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsecciones</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsecciones</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">preguntas</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">get_preguntas</span><span class="p">())</span>
        <span class="n">preguntas</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preguntas</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">preguntas</span>

    <span class="k">def</span> <span class="nf">preguntas_ordenadas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pregunta_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;orden&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cuestionario</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">u&#39;Sección  {0} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">superseccion</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">u&#39;Subsección {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;orden&#39;</span><span class="p">]</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">u&#39;sección&#39;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">&#39;secciones&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-pregunta">
<span id="class-pregunta"></span><h2>3.19. Clase Pregunta<a class="headerlink" href="#clase-pregunta" title="Permalink to this headline">¶</a></h2>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pregunta</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">codigo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;20&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">texto</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">descripcion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># Observaciones adicionales a la contestacion o respuesta</span>
    <span class="c"># Se almacena solo un titulo o tema de las observaciones</span>
    <span class="n">observaciones</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;70&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">orden</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">tipo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">TipoPregunta</span><span class="p">)</span>
    <span class="n">seccion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Seccion</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;preguntas&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_codigo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Devuelve el codigo de la seccion mas el de la pregunta &quot;&quot;&quot;</span>
        <span class="n">codigo_seccion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seccion</span><span class="o">.</span><span class="n">codigo</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seccion</span><span class="o">.</span><span class="n">orden</span><span class="p">)</span>
        <span class="n">codigo_pregunta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">codigo</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orden</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;{0}.{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">codigo_seccion</span><span class="p">,</span> <span class="n">codigo_pregunta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">lxml</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">document_fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">texto</span><span class="p">)</span>
        <span class="n">texto</span> <span class="o">=</span> <span class="s">u&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">text_content</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">texto</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;seccion__orden&#39;</span><span class="p">,</span> <span class="s">&#39;orden&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-itempregunta">
<span id="class-itempregunta"></span><h2>3.20. Clase ItemPregunta<a class="headerlink" href="#clase-itempregunta" title="Permalink to this headline">¶</a></h2>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ItemPregunta</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># Valor para la contestación de la pregunta</span>
    <span class="n">texto</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;50&#39;</span><span class="p">)</span>
    <span class="c"># Notas adicionales aclaratorias para el Item de pregunta</span>
    <span class="n">descripcion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;70&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">pregunta</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Pregunta</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;items&#39;</span><span class="p">)</span>
    <span class="n">orden</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">texto</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;-orden&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-areasga">
<span id="class-areasga"></span><h2>3.21. Clase AreaSGA<a class="headerlink" href="#clase-areasga" title="Permalink to this headline">¶</a></h2>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AreaSGA</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">siglas</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">)</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;256&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">siglas</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-periodoevaluacion">
<span id="class-periodoevaluacion"></span><h2>3.22. Clase PeriodoEvaluacion<a class="headerlink" href="#clase-periodoevaluacion" title="Permalink to this headline">¶</a></h2>
<p>code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PeriodoEvaluacion</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;100&#39;</span><span class="p">)</span>
    <span class="n">titulo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;300&#39;</span><span class="p">)</span>
    <span class="n">descripcion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">observaciones</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">inicio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">fin</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">periodoAcademico</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;PeriodoAcademico&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;periodosEvaluacion&#39;</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">&quot;Periodo Académico&quot;</span><span class="p">)</span>
    <span class="n">areasSGA</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">AreaSGA</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;periodosEvaluacion&#39;</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">u&#39;Areas Académicas SGA&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;inicio&#39;</span><span class="p">,</span> <span class="s">&#39;fin&#39;</span><span class="p">]</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">u&#39;Periodo Evaluación&#39;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">u&#39;Periodos de Evaluación&#39;</span>

    <span class="k">def</span> <span class="nf">noIniciado</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ahora</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ahora</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">inicio</span>

    <span class="k">def</span> <span class="nf">vigente</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ahora</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inicio</span> <span class="o">&lt;=</span>  <span class="n">ahora</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fin</span>

    <span class="k">def</span> <span class="nf">finalizado</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ahora</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ahora</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fin</span>

    <span class="k">def</span> <span class="nf">verificar_estudiante</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cedula</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analiza si el Estudiante a realizado todas las evaluaciones</span>
<span class="sd">        que le corresponden en este Periodo de Evaluación.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">EstudiantePeriodoAcademico</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">usuario__cedula</span><span class="o">=</span><span class="n">cedula</span><span class="p">,</span> <span class="n">periodoAcademico</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoAcademico</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">EstudiantePeriodoAcademico</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="n">logg</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Verificar estudiante: dni {} no existe&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cedula</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">evaluaciones</span> <span class="o">=</span> <span class="n">Evaluacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">estudianteAsignaturaDocente__estudiante__usuario__cedula</span><span class="o">=</span><span class="n">cedula</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">EstudianteAsignaturaDocente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">estudiante__usuario__cedula</span><span class="o">=</span><span class="n">cedula</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">estudiante__periodoAcademico</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoAcademico</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">restantes</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="n">evaluaciones</span>
        <span class="n">mensaje</span> <span class="o">=</span> <span class="s">u&quot;{0}: total {1}, evaluados {2}, restan {3} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cedula</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">evaluaciones</span><span class="p">,</span> <span class="n">restantes</span><span class="p">)</span>
        <span class="n">logg</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">mensaje</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">restantes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">contabilizar_evaluaciones_estudiantes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">carrera</span><span class="p">,</span> <span class="n">semestre</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">paralelo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Contabiliza evaluaciones de Estudiantes &quot;&quot;&quot;</span>
        <span class="n">consulta</span> <span class="o">=</span> <span class="n">EstudianteAsignaturaDocente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">estudiante__periodoAcademico</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodoAcademico</span><span class="p">,</span>
            <span class="n">asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">area</span><span class="p">,</span>
            <span class="n">asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">carrera</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">semestre</span> <span class="ow">and</span> <span class="n">semestre</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">consulta</span> <span class="o">=</span> <span class="n">consulta</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">asignaturaDocente__asignatura__semestre</span><span class="o">=</span><span class="n">semestre</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">paralelo</span> <span class="ow">and</span> <span class="n">paralelo</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">consulta</span> <span class="o">=</span> <span class="n">consulta</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">asignaturaDocente__asignatura__paralelo</span><span class="o">=</span><span class="n">paralelo</span><span class="p">)</span>
        <span class="n">estudiantes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">estudiante</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">consulta</span><span class="o">.</span><span class="n">all</span><span class="p">()])</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">estudiantes</span><span class="p">)</span>
        <span class="n">completados</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">faltantes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">estudiantes</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verificar_estudiante</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">usuario</span><span class="o">.</span><span class="n">cedula</span><span class="p">):</span>
                <span class="n">completados</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">faltantes</span> <span class="o">+=</span><span class="mi">1</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">estudiantes</span><span class="o">=</span><span class="n">total</span><span class="p">,</span> <span class="n">completados</span><span class="o">=</span><span class="n">completados</span><span class="p">,</span> <span class="n">faltantes</span><span class="o">=</span><span class="n">faltantes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">contabilizar_evaluadores</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cuenta los estudiantes, pares academicos y directores que HAYAN EVALUADO</span>
<span class="sd">        a por lo menos un docente. No se controla haber evaluado a todos los docentes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">estudiantes</span> <span class="o">=</span> <span class="n">Evaluacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span>
            <span class="s">&#39;estudianteAsignaturaDocente__estudiante&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">docentes</span> <span class="o">=</span> <span class="n">Evaluacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">docentePeriodoAcademico__isnull</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">directorCarrera__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">parAcademico__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">pares</span> <span class="o">=</span> <span class="n">Evaluacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">parAcademico__isnull</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
            <span class="s">&#39;parAcademico&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">directores</span> <span class="o">=</span> <span class="n">Evaluacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">directorCarrera__isnull</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
            <span class="s">&#39;directorCarrera&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">estudiantes</span><span class="o">=</span><span class="n">estudiantes</span><span class="p">,</span> <span class="n">docentes</span><span class="o">=</span><span class="n">docentes</span><span class="p">,</span> <span class="n">pares</span><span class="o">=</span><span class="n">pares</span><span class="p">,</span> <span class="n">directores</span><span class="o">=</span><span class="n">directores</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">contabilizar_evaluados</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cuenta los estudiantes, pares academicos y directores que HAN SIDO EVALUADOS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">porEstudiantes</span> <span class="o">=</span> <span class="n">Evaluacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">estudianteAsignaturaDocente__isnull</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span>
            <span class="s">&#39;estudianteAsignaturaDocente__asignaturaDocente__docente&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">porDocentes</span> <span class="o">=</span> <span class="n">Evaluacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">docentePeriodoAcademico__isnull</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">directorCarrera__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">parAcademico__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">porPares</span> <span class="o">=</span> <span class="n">Evaluacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">parAcademico__isnull</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
            <span class="s">&#39;docentePeriodoAcademico&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">porDirectores</span> <span class="o">=</span> <span class="n">Evaluacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">directorCarrera__isnull</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
            <span class="s">&#39;docentePeriodoAcademico&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">porEstudiantes</span><span class="o">=</span><span class="n">porEstudiantes</span><span class="p">,</span> <span class="n">porDocentes</span><span class="o">=</span><span class="n">porDocentes</span><span class="p">,</span> <span class="n">porPares</span><span class="o">=</span><span class="n">porPares</span><span class="p">,</span> <span class="n">porDirectores</span><span class="o">=</span><span class="n">porDirectores</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nombre</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-tabulacion">
<span id="class-tabulacion"></span><h2>3.23. Clase Tabulacion<a class="headerlink" href="#clase-tabulacion" title="Permalink to this headline">¶</a></h2>
<p>Estracto:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># TODO: Modelar de mejor manera la funcionalidad</span>
<span class="n">tipos_tabulacion</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s">u&#39;ESE2012&#39;</span><span class="p">,</span> <span class="s">u&#39;Tabulación Satisfacción Estudiantil 2012&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">u&#39;EAAD2012&#39;</span><span class="p">,</span> <span class="s">u&#39;Tabulación Actividades Adicionales Docencia 2011-2012&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">u&#39;EDD2013&#39;</span><span class="p">,</span> <span class="s">u&#39;Tabulación Evaluación del Desempeño Docente 2012-2013&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Tabulacion</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Superclase que permite procesar la informacion generada por un</span>
<span class="sd">    conjunto de encuestas pertenecientes a un Periodo de Evaluación.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">descripcion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;250&#39;</span><span class="p">)</span>
    <span class="n">tipo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span> <span class="n">max_length</span><span class="o">=</span><span class="s">&#39;20&#39;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">tipos_tabulacion</span><span class="p">)</span>
    <span class="n">periodoEvaluacion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="s">&#39;PeriodoEvaluacion&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;tabulacion&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">&quot;Tabulaciones&quot;</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">descripcion</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-tabulacionevaluacion2013">
<span id="class-tabulacionevaluacion2013"></span><h2>3.24. Clase TabulacionEvaluacion2013<a class="headerlink" href="#clase-tabulacionevaluacion2013" title="Permalink to this headline">¶</a></h2>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TabulacionEvaluacion2013</span><span class="p">:</span>
    <span class="n">tipo</span> <span class="o">=</span> <span class="s">u&#39;EDA2013&#39;</span>
    <span class="n">descripcion</span> <span class="o">=</span> <span class="s">u&#39;Evaluación del Desempeño Docente 2012-2013&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">periodoEvaluacion</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span> <span class="o">=</span> <span class="n">periodoEvaluacion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculos</span> <span class="o">=</span> <span class="p">(</span>
            <span class="c"># codigo, descripcion, metodo, titulo</span>
            <span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">u&#39;Resultados de la Evaluación del Desempeño Académico POR DOCENTE&#39;</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">por_docente</span><span class="p">,</span> <span class="s">u&#39;Evaluación del Desempeño Académico por Docente&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">u&#39;Resultados de la Evaluación del Desempeño Académico POR CARRERA&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">por_carrera</span><span class="p">,</span> <span class="s">u&#39;Evaluación del Desempeño Académico por Carrera&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">u&#39;Resultados de la Evaluación del Desempeño Académico POR AREA&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">por_area</span><span class="p">,</span> <span class="s">u&#39;Evaluación del Desempeño Académico por Area&#39;</span><span class="p">),</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">por_docente</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">,</span> <span class="n">id_docente</span><span class="p">,</span> <span class="n">componente</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># Se pasa un tupla no un solo id</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calcular</span><span class="p">(</span><span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">,</span> <span class="p">(</span><span class="n">id_docente</span><span class="p">,),</span> <span class="n">componente</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">por_carrera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">,</span> <span class="n">componente</span><span class="p">):</span>
        <span class="c"># Obtenemos los id de los Docentes que dictan Asignaturas en la carrera seleccionada</span>
        <span class="n">aux_ids</span> <span class="o">=</span> <span class="n">AsignaturaDocente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">docente__periodoAcademico</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="o">.</span><span class="n">periodoAcademico</span><span class="p">,</span>
            <span class="n">asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">,</span>
            <span class="n">asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span>
            <span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;docente__id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
        <span class="c"># Se agregan tambien los docentes que no tengan Asignaturas pero que pertenezcan a la Carrera</span>
        <span class="n">ids_docentes</span> <span class="o">=</span> <span class="n">DocentePeriodoAcademico</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">Q</span><span class="p">(</span><span class="n">periodoAcademico</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="o">.</span><span class="n">periodoAcademico</span><span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">aux_ids</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Q</span><span class="p">(</span><span class="n">carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">))</span>
            <span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;usuario__last_name&#39;</span><span class="p">,</span> <span class="s">&#39;usuario__first_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span>
            <span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calcular</span><span class="p">(</span><span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">,</span> <span class="n">ids_docentes</span><span class="p">,</span> <span class="n">componente</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">por_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">siglas_area</span><span class="p">,</span> <span class="n">componente</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># Obtenemos los id de los Docentes que dictan Asignaturas en el area seleccionada</span>
        <span class="n">aux_ids</span> <span class="o">=</span> <span class="n">AsignaturaDocente</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">docente__periodoAcademico</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="o">.</span><span class="n">periodoAcademico</span><span class="p">,</span>
            <span class="n">asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span>
            <span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;docente__id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
        <span class="c"># Se agregan tambien los docentes que no tengan Asignaturas pero que pertenezcan a la Carrera</span>
        <span class="n">ids_docentes</span> <span class="o">=</span> <span class="n">DocentePeriodoAcademico</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">Q</span><span class="p">(</span><span class="n">periodoAcademico</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="o">.</span><span class="n">periodoAcademico</span><span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span> <span class="n">Q</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">aux_ids</span><span class="p">)</span> <span class="p">)</span><span class="c">#TODO: No hay el area en el atributo Carrera de DocentePeriodoAcademico</span>
            <span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;usuario__last_name&#39;</span><span class="p">,</span> <span class="s">&#39;usuario__first_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span>
            <span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calcular</span><span class="p">(</span><span class="n">siglas_area</span><span class="p">,</span> <span class="bp">None</span> <span class="p">,</span> <span class="n">ids_docentes</span><span class="p">,</span> <span class="n">componente</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">calcular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">,</span> <span class="n">ids_docentes</span><span class="p">,</span> <span class="n">componente</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Metodo generico para calcular los resultados de acuerdo a los diferentes criterios</span>
<span class="sd">        Si se trata del reporte de sugerencias se salta al metodo respectivo</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">componente</span> <span class="o">==</span> <span class="s">&#39;sugerencias&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extraer_sugerencias</span><span class="p">(</span><span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">,</span> <span class="n">ids_docentes</span><span class="p">)</span>

        <span class="n">resultados_indicadores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">pesos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">siglas_area</span> <span class="o">==</span> <span class="s">&#39;ACE&#39;</span><span class="p">:</span>
            <span class="n">tipos</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;EstudianteIdiomas&#39;</span><span class="p">,</span> <span class="s">&#39;DocenteIdiomas&#39;</span><span class="p">,</span> <span class="s">&#39;ParAcademicoIdiomas&#39;</span><span class="p">,</span> <span class="s">&#39;DirectivoIdiomas&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tipos</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Estudiante&#39;</span><span class="p">,</span> <span class="s">&#39;Docente&#39;</span><span class="p">,</span> <span class="s">&#39;ParAcademico&#39;</span><span class="p">,</span> <span class="s">&#39;Directivo&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">componente</span><span class="p">:</span>
            <span class="n">seccion_componente</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Se pasa de string a objeto seccion para sacar datos en la plantilla</span>
            <span class="n">seccion_componente</span> <span class="o">=</span> <span class="n">Seccion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">,</span> <span class="n">codigo</span><span class="o">=</span><span class="n">componente</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c"># -----------------------------------------------------------------------------------</span>
        <span class="c"># Promedios de cada indicador</span>
        <span class="c"># -----------------------------------------------------------------------------------</span>
        <span class="k">for</span> <span class="n">tipo</span> <span class="ow">in</span> <span class="n">tipos</span><span class="p">:</span>
            <span class="n">cuestionario</span> <span class="o">=</span> <span class="n">Cuestionario</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">,</span> <span class="n">informante__tipo</span><span class="o">=</span><span class="n">tipo</span><span class="p">)</span>
            <span class="c"># En caso de tratarse del insituto de idiomas se generaliza el informante</span>
            <span class="c"># Anecdota: Un error que me llevo mas de dos dias</span>
            <span class="n">informante</span> <span class="o">=</span> <span class="n">tipo</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;idiomas&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="c"># Para los calculos finales</span>
            <span class="n">pesos</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">informante</span> <span class="p">:</span> <span class="n">cuestionario</span><span class="o">.</span><span class="n">peso</span><span class="p">})</span>
            <span class="c"># Solo ids</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">componente</span><span class="p">:</span>
                <span class="n">preguntas</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cuestionario</span><span class="o">.</span><span class="n">get_preguntas</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">tipo</span><span class="o">==</span><span class="n">TipoPregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tipo</span><span class="o">=</span><span class="s">&#39;SeleccionUnica&#39;</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">preguntas</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cuestionario</span><span class="o">.</span><span class="n">get_preguntas</span><span class="p">()</span> <span class="k">if</span>
                             <span class="n">p</span><span class="o">.</span><span class="n">tipo</span><span class="o">==</span><span class="n">TipoPregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tipo</span><span class="o">=</span><span class="s">&#39;SeleccionUnica&#39;</span><span class="p">)</span> <span class="ow">and</span>
                             <span class="n">p</span><span class="o">.</span><span class="n">seccion</span><span class="o">.</span><span class="n">superseccion</span><span class="o">.</span><span class="n">codigo</span><span class="o">==</span><span class="n">componente</span> <span class="p">]</span>
            <span class="c"># Solo ids</span>
            <span class="n">contestaciones</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">informante</span> <span class="o">==</span> <span class="s">&#39;estudiante&#39;</span><span class="p">:</span>
                <span class="n">contestaciones</span> <span class="o">=</span> <span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__docente__id__in</span><span class="o">=</span><span class="n">ids_docentes</span><span class="p">,</span>
                    <span class="n">pregunta__in</span><span class="o">=</span><span class="n">preguntas</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">informante</span> <span class="o">==</span> <span class="s">&#39;docente&#39;</span><span class="p">:</span>
                <span class="n">contestaciones</span> <span class="o">=</span> <span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="n">evaluacion__parAcademico__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">evaluacion__directorCarrera__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">evaluacion__docentePeriodoAcademico__id__in</span><span class="o">=</span><span class="n">ids_docentes</span><span class="p">,</span> <span class="n">pregunta__in</span><span class="o">=</span><span class="n">preguntas</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">informante</span> <span class="o">==</span> <span class="s">&#39;paracademico&#39;</span><span class="p">:</span>
                <span class="n">contestaciones</span> <span class="o">=</span> <span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="n">evaluacion__parAcademico__isnull</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">evaluacion__directorCarrera__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">evaluacion__docentePeriodoAcademico__id__in</span><span class="o">=</span><span class="n">ids_docentes</span><span class="p">,</span> <span class="n">pregunta__in</span><span class="o">=</span><span class="n">preguntas</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">informante</span> <span class="o">==</span> <span class="s">&#39;directivo&#39;</span><span class="p">:</span>
                <span class="n">contestaciones</span> <span class="o">=</span> <span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="n">evaluacion__directorCarrera__isnull</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">evaluacion__parAcademico__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">evaluacion__docentePeriodoAcademico__id__in</span><span class="o">=</span><span class="n">ids_docentes</span><span class="p">,</span> <span class="n">pregunta__in</span><span class="o">=</span><span class="n">preguntas</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">contestaciones</span><span class="p">:</span>
                <span class="c"># Otencion de promedios por pregunta</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;&quot;&quot;SELECT pregunta, AVG(respuesta::INT) FROM app_contestacion</span>
<span class="s">                       WHERE id IN </span><span class="si">%s</span><span class="s"> GROUP BY pregunta&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">contestaciones</span><span class="p">)])</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># El informante no ha contestado el cuestionario correspondiente</span>
                <span class="n">logg</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;No hay evaluaciones del informante {0} para los docentes {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tipo</span><span class="p">,</span><span class="n">ids_docentes</span><span class="p">))</span>
                <span class="k">print</span> <span class="s">&quot;No hay contestaciones de &quot;</span> <span class="o">+</span> <span class="n">tipo</span> <span class="o">+</span> <span class="s">&#39; para &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ids_docentes</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">id</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">preguntas</span><span class="p">]</span>

            <span class="c"># Diccionario a partir de lista compresa de tuplas conformadas por ids de pregunta con sus promedio</span>
            <span class="n">promedios_preguntas</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_pregunta</span><span class="p">),</span> <span class="n">promedio</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_pregunta</span><span class="p">,</span> <span class="n">promedio</span> <span class="ow">in</span> <span class="n">result</span><span class="p">])</span>
            <span class="n">indicadores</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c"># Sumatorias por pregunta</span>
            <span class="k">for</span> <span class="n">pregunta</span><span class="p">,</span> <span class="n">promedio</span> <span class="ow">in</span> <span class="n">promedios_preguntas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">suma</span> <span class="o">=</span> <span class="n">indicadores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pregunta</span><span class="o">.</span><span class="n">seccion</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">promedio</span>
                <span class="c">###indicadores[pregunta.seccion] = suma</span>
                <span class="n">indicadores</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">pregunta</span><span class="o">.</span><span class="n">seccion</span><span class="p">:</span> <span class="n">suma</span><span class="p">})</span>
            <span class="c"># Promedio por seccion (indicador)</span>
            <span class="k">for</span> <span class="n">seccion</span><span class="p">,</span> <span class="n">suma</span> <span class="ow">in</span> <span class="n">indicadores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">promedio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">suma</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">seccion</span><span class="o">.</span><span class="n">preguntas</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
                <span class="n">indicadores</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">seccion</span> <span class="p">:</span> <span class="n">promedio</span><span class="p">})</span>
            <span class="c"># Porcentaje por seccion (indicador)</span>
            <span class="n">ESCALA_MAXIMA</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">for</span> <span class="n">seccion</span><span class="p">,</span> <span class="n">promedio</span> <span class="ow">in</span> <span class="n">indicadores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">porcentaje</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="mi">100</span> <span class="o">*</span> <span class="n">promedio</span><span class="p">)</span> <span class="o">/</span> <span class="n">ESCALA_MAXIMA</span><span class="p">)</span>
                <span class="n">indicadores</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">seccion</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">porcentaje</span><span class="p">)})</span>
            <span class="c"># Genera diccionario de diccionarios</span>
            <span class="k">for</span> <span class="n">seccion</span><span class="p">,</span> <span class="n">porcentaje</span> <span class="ow">in</span> <span class="n">indicadores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Los &#39;Objetos&#39; Seccion son diferentes pues pertenecen a Cuestionarios diferentes</span>
<span class="sd">                por tal motivo se usa el codigo como clave del diccionario para sumarizar los</span>
<span class="sd">                porcentajes de las secciones con el mismo codigo en todos los Cuestionarios.</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">indicador</span> <span class="o">=</span> <span class="n">resultados_indicadores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">seccion</span><span class="o">.</span><span class="n">codigo</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">indicador</span><span class="p">:</span>
                    <span class="c"># Se guarda el atributo ponderacion solo la primera vez para luego calcular</span>
                    <span class="c"># Puesto que todas las secciones tienes los mismos datos</span>
                    <span class="n">indicador</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;informantes&#39;</span> <span class="p">:</span> <span class="p">{},</span> <span class="s">&#39;ponderacion_seccion&#39;</span> <span class="p">:</span> <span class="n">seccion</span><span class="o">.</span><span class="n">ponderacion</span><span class="p">}</span>
                <span class="c"># Se inserta ademas el objeto Seccion el indicador para disponer de informacion extra en el template</span>
                <span class="n">indicador</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;objeto_seccion&#39;</span> <span class="p">:</span> <span class="n">seccion</span><span class="p">})</span>
                <span class="n">indicador</span><span class="p">[</span><span class="s">&#39;informantes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span> <span class="n">informante</span> <span class="p">:</span> <span class="n">porcentaje</span> <span class="p">})</span>
                <span class="n">resultados_indicadores</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">seccion</span><span class="o">.</span><span class="n">codigo</span> <span class="p">:</span> <span class="n">indicador</span><span class="p">})</span>

        <span class="c"># -----------------------------------------------------------------------------------</span>
        <span class="c"># Calculos totales en todos los indicadores de acuerdo al peso de los informantes</span>
        <span class="c"># ------------------------------------------------------------------------------------</span>
        <span class="n">aux_estudiante</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">aux_docente</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">aux_paracademico</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">aux_directivo</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">promedio_primaria</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">promedio_ponderada</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c"># Solo el codigo de la seccion</span>
        <span class="k">for</span> <span class="n">seccion</span><span class="p">,</span> <span class="n">resultado</span> <span class="ow">in</span> <span class="n">resultados_indicadores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">valores</span> <span class="o">=</span> <span class="n">resultado</span><span class="p">[</span><span class="s">&#39;informantes&#39;</span><span class="p">]</span>
            <span class="n">informantes</span> <span class="o">=</span> <span class="n">valores</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">informantes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">primaria</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="c"># UN solo informante Comision Academica</span>
            <span class="k">if</span> <span class="n">informantes</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;directivo&#39;</span><span class="p">,</span> <span class="s">&#39;paracademico&#39;</span><span class="p">]:</span>
                <span class="c"># (pdir * vdir) + (ppa * vpa)) / (pdir + ppa)</span>
                <span class="n">primaria</span> <span class="o">=</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;directivo&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">valores</span><span class="p">[</span><span class="s">&#39;directivo&#39;</span><span class="p">]</span> <span class="o">+</span>  <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;paracademico&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">valores</span><span class="p">[</span><span class="s">&#39;paracademico&#39;</span><span class="p">]</span>
                <span class="n">primaria</span> <span class="o">=</span> <span class="n">primaria</span> <span class="o">/</span> <span class="p">(</span><span class="n">pesos</span><span class="p">[</span><span class="s">&#39;directivo&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;paracademico&#39;</span><span class="p">])</span>
            <span class="c"># DOS informantes</span>
            <span class="k">elif</span> <span class="n">informantes</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;directivo&#39;</span><span class="p">,</span> <span class="s">&#39;docente&#39;</span><span class="p">,</span> <span class="s">&#39;paracademico&#39;</span><span class="p">]:</span>
                <span class="c"># ((mpne + pdir * vdir) + (mpne + ppa * vpa) + (??? + pd * cd))</span>
                <span class="n">mitad</span> <span class="o">=</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;estudiante&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">primaria</span> <span class="o">=</span>  <span class="p">(</span><span class="n">mitad</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;directivo&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">valores</span><span class="p">[</span><span class="s">&#39;directivo&#39;</span><span class="p">]</span>
                <span class="n">primaria</span> <span class="o">+=</span> <span class="p">(</span><span class="n">mitad</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;paracademico&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">valores</span><span class="p">[</span><span class="s">&#39;paracademico&#39;</span><span class="p">]</span>
                <span class="n">primaria</span> <span class="o">+=</span> <span class="p">(</span><span class="n">mitad</span> <span class="o">+</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;docente&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">valores</span><span class="p">[</span><span class="s">&#39;docente&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">informantes</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;directivo&#39;</span><span class="p">,</span> <span class="s">&#39;estudiante&#39;</span><span class="p">,</span> <span class="s">&#39;paracademico&#39;</span><span class="p">]:</span>
                <span class="c"># ((mpne + pdir * vdir) + (mpne + ppa * vpa) + (??? + pd * cd))</span>
                <span class="n">mitad</span> <span class="o">=</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;docente&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">primaria</span> <span class="o">=</span>  <span class="p">(</span><span class="n">mitad</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;directivo&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">valores</span><span class="p">[</span><span class="s">&#39;directivo&#39;</span><span class="p">]</span>
                <span class="n">primaria</span> <span class="o">+=</span> <span class="p">(</span><span class="n">mitad</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;paracademico&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">valores</span><span class="p">[</span><span class="s">&#39;paracademico&#39;</span><span class="p">]</span>
                <span class="n">primaria</span> <span class="o">+=</span> <span class="p">(</span><span class="n">mitad</span> <span class="o">+</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;estudiante&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">valores</span><span class="p">[</span><span class="s">&#39;estudiante&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">informantes</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;docente&#39;</span><span class="p">,</span> <span class="s">&#39;estudiante&#39;</span><span class="p">]:</span>
                <span class="c"># (mpni + pe * ve) + (mpni + pd * vd)</span>
                <span class="n">mitad</span> <span class="o">=</span> <span class="p">(</span><span class="n">pesos</span><span class="p">[</span><span class="s">&#39;directivo&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;paracademico&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">primaria</span> <span class="o">=</span> <span class="p">(</span><span class="n">mitad</span> <span class="o">+</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;estudiante&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">valores</span><span class="p">[</span><span class="s">&#39;estudiante&#39;</span><span class="p">]</span>
                <span class="n">primaria</span> <span class="o">+=</span> <span class="p">(</span><span class="n">mitad</span> <span class="o">+</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;docente&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">valores</span><span class="p">[</span><span class="s">&#39;docente&#39;</span><span class="p">]</span>
            <span class="c"># TRES informantes</span>
            <span class="k">elif</span> <span class="n">informantes</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;directivo&#39;</span><span class="p">,</span> <span class="s">&#39;docente&#39;</span><span class="p">,</span> <span class="s">&#39;estudiante&#39;</span><span class="p">,</span> <span class="s">&#39;paracademico&#39;</span><span class="p">]:</span>
                <span class="c"># (pe + ve) + ((pdir * vdir) + (ppa * vpa)) + (pd * vd))</span>
                <span class="n">primaria</span> <span class="o">=</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;estudiante&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">valores</span><span class="p">[</span><span class="s">&#39;estudiante&#39;</span><span class="p">]</span>
                <span class="n">primaria</span> <span class="o">+=</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;docente&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">valores</span><span class="p">[</span><span class="s">&#39;docente&#39;</span><span class="p">]</span>
                <span class="n">primaria</span> <span class="o">+=</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;paracademico&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">valores</span><span class="p">[</span><span class="s">&#39;paracademico&#39;</span><span class="p">]</span>
                <span class="n">primaria</span> <span class="o">+=</span> <span class="n">pesos</span><span class="p">[</span><span class="s">&#39;directivo&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">valores</span><span class="p">[</span><span class="s">&#39;directivo&#39;</span><span class="p">]</span>

            <span class="n">primaria</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">primaria</span><span class="p">)</span>
            <span class="n">resultado</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;primaria&#39;</span> <span class="p">:</span> <span class="n">primaria</span><span class="p">})</span>
            <span class="n">promedio_primaria</span> <span class="o">+=</span> <span class="n">primaria</span>
            <span class="n">ponderada</span> <span class="o">=</span> <span class="n">primaria</span> <span class="o">*</span> <span class="n">resultado</span><span class="p">[</span><span class="s">&#39;ponderacion_seccion&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="n">promedio_ponderada</span> <span class="o">+=</span> <span class="n">ponderada</span>
            <span class="n">resultado</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;ponderada&#39;</span> <span class="p">:</span> <span class="n">ponderada</span><span class="p">})</span>
            <span class="n">resultado</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;cualitativa&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cualificar_valor</span><span class="p">(</span><span class="n">primaria</span><span class="p">)})</span>
            <span class="n">aux_estudiante</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;estudiante&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">aux_directivo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;directivo&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">aux_docente</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;docente&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">aux_paracademico</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;paracademico&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="c"># En caso de que no se tata de un componente en particular</span>
        <span class="k">if</span>  <span class="ow">not</span> <span class="n">componente</span><span class="p">:</span>
            <span class="c"># Se envia a calcular los promedios por cada componente</span>
            <span class="n">promedios_componentes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calcular_componentes</span><span class="p">(</span><span class="n">resultados_indicadores</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">promedios_componentes</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">aux_estudiante</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">aux_estudiante</span> <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">aux_docente</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">aux_docente</span> <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">aux_paracademico</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">aux_paracademico</span> <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">aux_directivo</span>  <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">aux_directivo</span> <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>

        <span class="n">prom_estudiante</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">aux_estudiante</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux_estudiante</span><span class="p">)))</span> <span class="k">if</span> <span class="n">aux_estudiante</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">prom_docente</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">aux_docente</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux_docente</span><span class="p">)))</span> <span class="k">if</span> <span class="n">aux_docente</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">prom_paracademico</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">aux_paracademico</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux_paracademico</span><span class="p">)))</span> <span class="k">if</span> <span class="n">aux_paracademico</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">prom_directivo</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">aux_directivo</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux_directivo</span><span class="p">)))</span> <span class="k">if</span> <span class="n">aux_directivo</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="n">promedio_primaria</span> <span class="o">=</span> <span class="p">(</span><span class="n">promedio_primaria</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">resultados_indicadores</span><span class="p">))</span> <span class="k">if</span> <span class="n">resultados_indicadores</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="c"># Solo se suma la ponderacion hasta el final</span>
        <span class="n">promedios</span><span class="o">=</span> <span class="p">{</span><span class="s">&#39;estudiante&#39;</span> <span class="p">:</span> <span class="n">prom_estudiante</span><span class="p">,</span>
                    <span class="s">&#39;docente&#39;</span> <span class="p">:</span> <span class="n">prom_docente</span><span class="p">,</span>
                    <span class="s">&#39;paracademico&#39;</span> <span class="p">:</span> <span class="n">prom_paracademico</span><span class="p">,</span>
                    <span class="s">&#39;directivo&#39;</span> <span class="p">:</span> <span class="n">prom_directivo</span><span class="p">,</span>
                    <span class="s">&#39;primaria&#39;</span> <span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">promedio_primaria</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                    <span class="s">&#39;ponderada&#39;</span> <span class="p">:</span> <span class="n">promedio_ponderada</span><span class="p">,</span>
                    <span class="s">&#39;cualitativa&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cualificar_valor</span><span class="p">(</span><span class="n">promedio_primaria</span><span class="p">)</span>
                    <span class="p">}</span>
        <span class="c"># Se ordena el diccionario por la clave (codigo del indicador)</span>
        <span class="n">resultados_indicadores</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">resultados_indicadores</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">logg</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Calculado docente: {0} promedios: {1} total: {2}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ids_docentes</span><span class="p">,</span> <span class="n">promedios</span><span class="p">,</span> <span class="n">promedio_ponderada</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">resultados_indicadores</span><span class="o">=</span><span class="n">resultados_indicadores</span><span class="p">,</span> <span class="n">promedios_componentes</span><span class="o">=</span><span class="n">promedios_componentes</span><span class="p">,</span>
                    <span class="n">promedios</span><span class="o">=</span><span class="n">promedios</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">promedio_ponderada</span><span class="p">,</span> <span class="n">seccion_componente</span><span class="o">=</span><span class="n">seccion_componente</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calcular_componentes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resultados_indicadores</span><span class="p">):</span>
        <span class="n">promedios_componentes</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;CPF&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;estudiante&#39;</span><span class="p">:[],</span> <span class="s">&#39;docente&#39;</span><span class="p">:[],</span> <span class="s">&#39;paracademico&#39;</span><span class="p">:[],</span> <span class="s">&#39;directivo&#39;</span><span class="p">:[],</span>
                                          <span class="s">&#39;primaria&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;ponderada&#39;</span><span class="p">:[],</span> <span class="s">&#39;cualitativa&#39;</span><span class="p">:</span><span class="s">&#39;&#39;</span><span class="p">},</span>
                                 <span class="s">&#39;CPG&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;estudiante&#39;</span><span class="p">:[],</span> <span class="s">&#39;docente&#39;</span><span class="p">:[],</span> <span class="s">&#39;paracademico&#39;</span><span class="p">:[],</span> <span class="s">&#39;directivo&#39;</span><span class="p">:[],</span>
                                          <span class="s">&#39;primaria&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;ponderada&#39;</span><span class="p">:[],</span> <span class="s">&#39;cualitativa&#39;</span><span class="p">:</span><span class="s">&#39;&#39;</span><span class="p">},</span>
                                 <span class="s">&#39;PV&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;estudiante&#39;</span><span class="p">:[],</span> <span class="s">&#39;docente&#39;</span><span class="p">:[],</span> <span class="s">&#39;paracademico&#39;</span><span class="p">:[],</span> <span class="s">&#39;directivo&#39;</span><span class="p">:[],</span>
                                          <span class="s">&#39;primaria&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;ponderada&#39;</span><span class="p">:[],</span> <span class="s">&#39;cualitativa&#39;</span><span class="p">:</span><span class="s">&#39;&#39;</span><span class="p">},</span>
                                 <span class="p">}</span>
        <span class="k">for</span> <span class="n">codigo_seccion</span><span class="p">,</span> <span class="n">resultado</span> <span class="ow">in</span> <span class="n">resultados_indicadores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">componente</span> <span class="o">=</span> <span class="n">resultado</span><span class="p">[</span><span class="s">&#39;objeto_seccion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">superseccion</span><span class="o">.</span><span class="n">codigo</span>
            <span class="n">promedios_componentes</span><span class="p">[</span><span class="n">componente</span><span class="p">][</span><span class="s">&#39;estudiante&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resultado</span><span class="p">[</span><span class="s">&#39;informantes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;estudiante&#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">promedios_componentes</span><span class="p">[</span><span class="n">componente</span><span class="p">][</span><span class="s">&#39;docente&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resultado</span><span class="p">[</span><span class="s">&#39;informantes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;docente&#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">promedios_componentes</span><span class="p">[</span><span class="n">componente</span><span class="p">][</span><span class="s">&#39;paracademico&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resultado</span><span class="p">[</span><span class="s">&#39;informantes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;paracademico&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">promedios_componentes</span><span class="p">[</span><span class="n">componente</span><span class="p">][</span><span class="s">&#39;directivo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resultado</span><span class="p">[</span><span class="s">&#39;informantes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;directivo&#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">promedios_componentes</span><span class="p">[</span><span class="n">componente</span><span class="p">][</span><span class="s">&#39;primaria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resultado</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;primaria&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">promedios_componentes</span><span class="p">[</span><span class="n">componente</span><span class="p">][</span><span class="s">&#39;ponderada&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resultado</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ponderada&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">componente</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;CPF&#39;</span><span class="p">,</span> <span class="s">&#39;CPG&#39;</span><span class="p">,</span> <span class="s">&#39;PV&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">tipo_promedio</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;estudiante&#39;</span><span class="p">,</span> <span class="s">&#39;docente&#39;</span><span class="p">,</span> <span class="s">&#39;paracademico&#39;</span><span class="p">,</span> <span class="s">&#39;directivo&#39;</span><span class="p">,</span> <span class="s">&#39;primaria&#39;</span><span class="p">,</span> <span class="s">&#39;ponderada&#39;</span><span class="p">):</span>
                <span class="n">lista</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">promedios_componentes</span><span class="p">[</span><span class="n">componente</span><span class="p">][</span><span class="n">tipo_promedio</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">tipo_promedio</span> <span class="o">==</span> <span class="s">&#39;ponderada&#39;</span><span class="p">:</span>
                    <span class="n">promedio</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">lista</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">promedio</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">lista</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">lista</span><span class="p">)</span>
                <span class="c"># En este momento se cambia el contenido tipo lista por un numero</span>
                <span class="n">promedios_componentes</span><span class="p">[</span><span class="n">componente</span><span class="p">][</span><span class="n">tipo_promedio</span><span class="p">]</span> <span class="o">=</span> <span class="n">promedio</span>
            <span class="n">promedios_componentes</span><span class="p">[</span><span class="n">componente</span><span class="p">][</span><span class="s">&#39;cualitativa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cualificar_valor</span><span class="p">(</span>
                <span class="n">promedios_componentes</span><span class="p">[</span><span class="n">componente</span><span class="p">][</span><span class="s">&#39;primaria&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">promedios_componentes</span>

    <span class="k">def</span> <span class="nf">_cualificar_valor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Se cualifica con valores enteros &quot;&quot;&quot;</span>
        <span class="n">rangos</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;IS&#39;</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">41</span><span class="p">),</span> <span class="s">&#39;PS&#39;</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span><span class="mi">61</span><span class="p">),</span> <span class="s">&#39;S&#39;</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">61</span><span class="p">,</span><span class="mi">81</span><span class="p">),</span> <span class="s">&#39;D&#39;</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">81</span><span class="p">,</span><span class="mi">101</span><span class="p">)}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">rangos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nb">round</span><span class="p">(</span><span class="n">valor</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">k</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">extraer_sugerencias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">carrera</span><span class="p">,</span> <span class="n">ids_docentes</span><span class="p">):</span>
        <span class="n">sugerencias</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">area</span> <span class="o">==</span> <span class="s">&#39;ACE&#39;</span><span class="p">:</span>
            <span class="n">tipos</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;EstudianteIdiomas&#39;</span><span class="p">,</span> <span class="s">&#39;DocenteIdiomas&#39;</span><span class="p">,</span> <span class="s">&#39;ParAcademicoIdiomas&#39;</span><span class="p">,</span> <span class="s">&#39;DirectivoIdiomas&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tipos</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Estudiante&#39;</span><span class="p">,</span> <span class="s">&#39;Docente&#39;</span><span class="p">,</span> <span class="s">&#39;ParAcademico&#39;</span><span class="p">,</span> <span class="s">&#39;Directivo&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">id_docente</span> <span class="ow">in</span> <span class="n">ids_docentes</span><span class="p">:</span>
            <span class="n">resultado</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c"># Solo nombres del docente</span>
            <span class="n">nombre_docente</span> <span class="o">=</span> <span class="n">DocentePeriodoAcademico</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">)</span><span class="o">.</span><span class="n">__unicode__</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">tipo</span> <span class="ow">in</span> <span class="n">tipos</span><span class="p">:</span>
                <span class="n">informante</span> <span class="o">=</span> <span class="n">tipo</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;idiomas&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="c"># Codigo es PV, CPG o CPF</span>
                <span class="n">preguntas_ensayo</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="n">seccion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">,</span>
                    <span class="n">seccion__cuestionario__informante__tipo</span><span class="o">=</span><span class="n">tipo</span><span class="p">,</span> <span class="n">tipo__tipo</span><span class="o">=</span><span class="s">&#39;Ensayo&#39;</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;seccion__codigo&#39;</span><span class="p">)</span>
                <span class="n">resultado</span><span class="p">[</span><span class="n">tipo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c"># Contendra 3 items, uno por cada componente</span>
                <span class="n">aux_contestaciones</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">informante</span> <span class="o">==</span> <span class="s">&#39;estudiante&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pregunta</span> <span class="ow">in</span> <span class="n">preguntas_ensayo</span><span class="p">:</span>
                        <span class="n">contestaciones</span> <span class="o">=</span> <span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                            <span class="n">evaluacion__cuestionario__informante__tipo__icontains</span><span class="o">=</span><span class="s">&#39;estudiante&#39;</span><span class="p">,</span>
                            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__docente__id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">,</span>
                            <span class="n">pregunta</span><span class="o">=</span><span class="n">pregunta</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">aux_contestaciones</span><span class="p">[</span><span class="n">pregunta</span><span class="p">[</span><span class="s">&#39;seccion__codigo&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">contestaciones</span>
                <span class="k">elif</span> <span class="n">informante</span> <span class="o">==</span> <span class="s">&#39;docente&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pregunta</span> <span class="ow">in</span> <span class="n">preguntas_ensayo</span><span class="p">:</span>
                        <span class="n">contestaciones</span> <span class="o">=</span> <span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                            <span class="n">evaluacion__parAcademico__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">evaluacion__directorCarrera__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">evaluacion__docentePeriodoAcademico__id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">,</span> <span class="n">pregunta</span><span class="o">=</span><span class="n">pregunta</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">aux_contestaciones</span><span class="p">[</span><span class="n">pregunta</span><span class="p">[</span><span class="s">&#39;seccion__codigo&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">contestaciones</span>
                <span class="k">elif</span> <span class="n">informante</span> <span class="o">==</span> <span class="s">&#39;paracademico&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pregunta</span> <span class="ow">in</span> <span class="n">preguntas_ensayo</span><span class="p">:</span>
                        <span class="n">contestaciones</span> <span class="o">=</span> <span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                            <span class="n">evaluacion__parAcademico__isnull</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">evaluacion__directorCarrera__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">evaluacion__docentePeriodoAcademico__id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">,</span> <span class="n">pregunta</span><span class="o">=</span><span class="n">pregunta</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">aux_contestaciones</span><span class="p">[</span><span class="n">pregunta</span><span class="p">[</span><span class="s">&#39;seccion__codigo&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">contestaciones</span>
                <span class="k">elif</span> <span class="n">informante</span> <span class="o">==</span> <span class="s">&#39;directivo&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pregunta</span> <span class="ow">in</span> <span class="n">preguntas_ensayo</span><span class="p">:</span>
                        <span class="n">contestaciones</span> <span class="o">=</span> <span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                            <span class="n">evaluacion__directorCarrera__isnull</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">evaluacion__parAcademico__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">evaluacion__docentePeriodoAcademico__id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">,</span> <span class="n">pregunta</span><span class="o">=</span><span class="n">pregunta</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">aux_contestaciones</span><span class="p">[</span><span class="n">pregunta</span><span class="p">[</span><span class="s">&#39;seccion__codigo&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">contestaciones</span>
                <span class="c"># Se supone que en los tres componentes hay la misma cantidad de respuestas CPF, CPG y PV</span>
                <span class="n">num_contestaciones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aux_contestaciones</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_contestaciones</span><span class="p">):</span>
                    <span class="n">aux_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;CPF&#39;</span> <span class="p">:</span> <span class="n">aux_contestaciones</span><span class="p">[</span><span class="s">&#39;CPF&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                <span class="s">&#39;CPG&#39;</span> <span class="p">:</span> <span class="n">aux_contestaciones</span><span class="p">[</span><span class="s">&#39;CPG&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                <span class="s">&#39;PV&#39;</span> <span class="p">:</span> <span class="n">aux_contestaciones</span><span class="p">[</span><span class="s">&#39;PV&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]}</span>
                    <span class="n">resultado</span><span class="p">[</span><span class="n">tipo</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux_dict</span><span class="p">)</span>
            <span class="n">sugerencias</span><span class="p">[</span><span class="n">nombre_docente</span><span class="p">]</span> <span class="o">=</span> <span class="n">resultado</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sugerencias</span><span class="o">=</span><span class="n">sugerencias</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-tabulacionadicionales2012">
<span id="class-tabulacionadicionales2012"></span><h2>3.25. Clase TabulacionAdicionales2012<a class="headerlink" href="#clase-tabulacionadicionales2012" title="Permalink to this headline">¶</a></h2>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TabulacionAdicionales2012</span><span class="p">:</span>
    <span class="n">tipo</span> <span class="o">=</span> <span class="s">u&#39;EAAD2012&#39;</span>
    <span class="n">descripcion</span> <span class="o">=</span> <span class="s">u&#39;Evaluación Actividades Adicionales a la Docencia 2012&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">periodoEvaluacion</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span> <span class="o">=</span> <span class="n">periodoEvaluacion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculos</span> <span class="o">=</span> <span class="p">(</span>
            <span class="c"># codigo, descripcion, metodo, titulo</span>
            <span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">u&#39;Resultados de la Evaluacion de Actividades Adicionales a la Docencia POR DOCENTE&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">por_docente</span><span class="p">,</span> <span class="s">u&#39;Evaluación Actividades Adicionales por Docente&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">u&#39;Resultados de la Evaluación de Actividades Adicionales a la Docencia POR CARRERA&#39;</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">por_carrera</span><span class="p">,</span> <span class="s">u&#39;Evaluación Actividades Adicionales por Carrera&#39;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">por_docente</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">,</span> <span class="n">id_docente</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resultados de la Evaluación de Actividades Adicionales a la Docencia 2012 POR DOCENTE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">docente</span> <span class="o">=</span> <span class="n">DocentePeriodoAcademico</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">)</span>
        <span class="c"># Procesamiento de la Autoevaluacion del Docente #</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># Autoevaluacion de Actividades Adicionales del Docente</span>
            <span class="n">autoevaluacion</span><span class="o">=</span><span class="n">docente</span><span class="o">.</span><span class="n">evaluaciones</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cuestionario__periodoEvaluacion__id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                                    <span class="n">cuestionario__informante__tipo</span><span class="o">=</span><span class="s">&#39;Docente&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">MultipleObjectsReturned</span><span class="p">:</span>
            <span class="c"># Existe una evaluacion duplicada</span>
            <span class="n">logg</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Autoevaluacion duplicada docente {0} en periodo:{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">docente</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="c"># Se toma la primera evaluacion</span>
            <span class="n">autoevaluacion</span> <span class="o">=</span> <span class="n">docente</span><span class="o">.</span><span class="n">evaluaciones</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cuestionario__periodoEvaluacion__id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                                         <span class="n">cuestionario__informante__tipo</span><span class="o">=</span><span class="s">&#39;Docente&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">Evaluacion</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="n">logg</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">u&#39;No existe autoevaluación del docente {0} en periodo:{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">docente</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="c"># Solo de seleccion unica</span>
        <span class="n">contestaciones1</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">autoevaluacion</span><span class="o">.</span><span class="n">contestaciones</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="k">if</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">pregunta</span><span class="p">)</span><span class="o">.</span><span class="n">tipo</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">total1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">respuesta</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contestaciones1</span><span class="p">])</span>
        <span class="n">peso</span> <span class="o">=</span> <span class="p">(</span><span class="n">total1</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contestaciones1</span><span class="p">)))</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contestaciones1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="k">else</span> <span class="mi">0</span>
        <span class="n">porcentaje1</span> <span class="o">=</span> <span class="p">(</span><span class="n">peso</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
        <span class="c"># Se coloca en Contestacion un objeto Pregunta en vez del id_pregunta entero</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contestaciones1</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">pregunta</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">pregunta</span><span class="p">)</span>
        <span class="c"># Procesamiento de la Evaluacion de la Comision Academica #</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># Evaluacion de Actividades Adicionales del Docente por parte de los Directivo</span>
            <span class="n">evaluacion</span><span class="o">=</span><span class="n">docente</span><span class="o">.</span><span class="n">evaluaciones</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cuestionario__periodoEvaluacion__id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                                    <span class="n">cuestionario__informante__tipo</span><span class="o">=</span><span class="s">&#39;Directivo&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">MultipleObjectsReturned</span><span class="p">:</span>
            <span class="c"># Existe una evaluacion duplicada</span>
            <span class="n">logg</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Evaluacion duplicada docente {0} en periodo:{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">docente</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="c"># Se toma la primera evaluacion</span>
            <span class="n">evaluacion</span> <span class="o">=</span> <span class="n">docente</span><span class="o">.</span><span class="n">evaluaciones</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cuestionario__periodoEvaluacion__id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                                         <span class="n">cuestionario__informante__tipo</span><span class="o">=</span><span class="s">&#39;Directivo&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">Evaluacion</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="n">logg</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">u&#39;No existe evaluación de directivos para el docente {0} en periodo:{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">docente</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="c"># Solo de seleccion unica</span>
        <span class="n">contestaciones2</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">evaluacion</span><span class="o">.</span><span class="n">contestaciones</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="k">if</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">pregunta</span><span class="p">)</span><span class="o">.</span><span class="n">tipo</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">total2</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">respuesta</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contestaciones2</span><span class="p">])</span>
        <span class="n">peso</span> <span class="o">=</span> <span class="p">(</span><span class="n">total2</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contestaciones2</span><span class="p">)))</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contestaciones2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">porcentaje2</span> <span class="o">=</span> <span class="p">(</span><span class="n">peso</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
        <span class="c"># Se coloca en Contestacion un objeto Pregunta en vez del id_pregunta entero</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contestaciones2</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">pregunta</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">pregunta</span><span class="p">)</span>
        <span class="c"># Valor Total obtenido con  ponderacion: Comision Academica 80% - Docente 20%</span>
        <span class="n">total</span> <span class="o">=</span> <span class="p">(</span><span class="n">porcentaje1</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">porcentaje2</span> <span class="o">*</span> <span class="mi">80</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">contestaciones</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">contestaciones</span><span class="p">[</span><span class="s">&#39;secciones&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Los dos cuestionarios tienen las mismas secciones</span>
        <span class="c"># TODO: Creo que se puede mejorar el este codigo</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">autoevaluacion</span><span class="o">.</span><span class="n">cuestionario</span><span class="o">.</span><span class="n">secciones</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">seccion</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;titulo&#39;</span><span class="p">:</span><span class="n">s</span><span class="o">.</span><span class="n">titulo</span><span class="p">,</span> <span class="s">&#39;resultados&#39;</span><span class="p">:</span> <span class="p">[]}</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">preguntas</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">respuesta</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contestaciones1</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">pregunta</span><span class="o">.</span><span class="n">codigo</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">codigo</span><span class="p">]</span>
                <span class="n">valor_docente</span> <span class="o">=</span> <span class="n">l1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">l1</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">observaciones</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contestaciones1</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">pregunta</span><span class="o">.</span><span class="n">codigo</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">codigo</span><span class="p">]</span>
                <span class="n">observaciones_docente</span> <span class="o">=</span> <span class="n">l1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">l1</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">respuesta</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contestaciones2</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">pregunta</span><span class="o">.</span><span class="n">codigo</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">codigo</span><span class="p">]</span>
                <span class="n">valor_comision</span> <span class="o">=</span> <span class="n">l2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">l2</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">observaciones</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contestaciones2</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">pregunta</span><span class="o">.</span><span class="n">codigo</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">codigo</span><span class="p">]</span>
                <span class="n">observaciones_comision</span> <span class="o">=</span> <span class="n">l2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">l2</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
                <span class="n">porcentaje_docente</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">valor_docente</span><span class="p">)</span><span class="o">*</span><span class="mi">25</span> <span class="k">if</span> <span class="n">valor_docente</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
                <span class="n">porcentaje_comision</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">valor_comision</span><span class="p">)</span><span class="o">*</span><span class="mi">25</span> <span class="k">if</span> <span class="n">valor_comision</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
                <span class="k">if</span> <span class="n">valor_docente</span> <span class="ow">or</span> <span class="n">valor_comision</span><span class="p">:</span>
                    <span class="n">seccion</span><span class="p">[</span><span class="s">&#39;resultados&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;codigo&#39;</span><span class="p">:</span><span class="n">p</span><span class="o">.</span><span class="n">codigo</span><span class="p">,</span> <span class="s">&#39;texto&#39;</span><span class="p">:</span><span class="n">p</span><span class="o">.</span><span class="n">texto</span><span class="p">,</span>
                                                  <span class="s">&#39;valor_comision&#39;</span><span class="p">:</span><span class="n">valor_comision</span><span class="p">,</span> <span class="s">&#39;valor_docente&#39;</span><span class="p">:</span><span class="n">valor_docente</span><span class="p">,</span>
                                                  <span class="s">&#39;porcentaje_comision&#39;</span><span class="p">:</span><span class="n">porcentaje_comision</span><span class="p">,</span> <span class="s">&#39;porcentaje_docente&#39;</span><span class="p">:</span><span class="n">porcentaje_docente</span><span class="p">,</span>
                                                  <span class="s">&#39;observaciones_comision&#39;</span><span class="p">:</span><span class="n">observaciones_comision</span><span class="p">,</span>
                                                  <span class="s">&#39;observaciones_docente&#39;</span><span class="p">:</span><span class="n">observaciones_docente</span><span class="p">})</span>
            <span class="n">contestaciones</span><span class="p">[</span><span class="s">&#39;secciones&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seccion</span><span class="p">)</span>
        <span class="n">num_actividades</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s">&#39;resultados&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">contestaciones</span><span class="p">[</span><span class="s">&#39;secciones&#39;</span><span class="p">]])</span>
        <span class="n">contestaciones</span><span class="p">[</span><span class="s">&#39;num_actividades&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_actividades</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">contestaciones1</span><span class="o">=</span><span class="n">contestaciones1</span><span class="p">,</span> <span class="n">porcentaje1</span><span class="o">=</span><span class="n">porcentaje1</span><span class="p">,</span>
                    <span class="n">contestaciones2</span><span class="o">=</span><span class="n">contestaciones2</span><span class="p">,</span> <span class="n">porcentaje2</span><span class="o">=</span><span class="n">porcentaje2</span><span class="p">,</span>
                    <span class="n">contestaciones</span><span class="o">=</span><span class="n">contestaciones</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">por_carrera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resultados de la Evaluación de Actividades Adicionales a la Docencia 2012 POR CARRERA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-tabulacionsatisfaccion2012">
<span id="class-tabulacionsatisfaccion2012"></span><h2>3.26. Clase TabulacionSatisfaccion2012<a class="headerlink" href="#clase-tabulacionsatisfaccion2012" title="Permalink to this headline">¶</a></h2>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TabulacionSatisfaccion2012</span><span class="p">:</span>
    <span class="c"># Se hecha de menos las clases Abstractas y el polimorfismo</span>
    <span class="c"># Esta clase no se persiste</span>

    <span class="n">tipo</span> <span class="o">=</span> <span class="s">u&#39;ESE2012&#39;</span>
    <span class="n">descripcion</span> <span class="o">=</span> <span class="s">u&#39;Encuesta de Satisfacción Estudiantil 2012&#39;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">periodoEvaluacion</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span> <span class="o">=</span> <span class="n">periodoEvaluacion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculos</span> <span class="o">=</span> <span class="p">(</span>
            <span class="c"># codigo, descripcion, metodo, titulo</span>
            <span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">u&#39;La valoracion global de la Satisfacción Estudiantil por DOCENTE&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">por_docente</span><span class="p">,</span> <span class="s">u&#39;Satisfacción Estudiantil por Docente&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">u&#39;La valoracion global de la Satisfacción Estudiantil por CARRERA&#39;</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">por_carrera</span><span class="p">,</span> <span class="s">u&#39;Satisfacción Estudiantil en la Carrera&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">u&#39;La valoracion  de la Satisfacción Estudiantil en cada uno de los CAMPOS, por carrera&#39;</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">por_campos</span><span class="p">,</span> <span class="s">u&#39;Satisfacción Estudiantil en Por Campos Específicos&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span><span class="s">u&#39;La valoración estudiantil en cada uno de los INDICADORES por carrera&#39;</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">por_indicador</span><span class="p">,</span> <span class="s">u&#39;Satisfacción Estudiantil por Indicador&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">,</span><span class="s">u&#39;Los 10 indicadores de mayor SATISFACCIÓN en la Carrera&#39;</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">mayor_satisfaccion</span><span class="p">,</span> <span class="s">u&#39;Indicadores de Mayor Satisfacción&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="s">u&#39;Los 10 indicadores de mayor INSATISFACCIÓN en la Carrera&#39;</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">mayor_insatisfaccion</span><span class="p">,</span> <span class="s">u&#39;Indicadores de mayor Insatisfacción&#39;</span><span class="p">),</span>
        <span class="p">)</span>


    <span class="c"># TODO: Pendiente refactorizar</span>
    <span class="k">def</span> <span class="nf">por_docente</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">,</span> <span class="n">id_docente</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Satisfacción Estudiantil de un docente en los  módulos, cursos, unidades o talleres</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">siglas_area</span> <span class="o">==</span> <span class="s">u&#39;ACE&#39;</span><span class="p">:</span>
            <span class="n">secciones</span> <span class="o">=</span> <span class="n">Seccion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cuestionario__in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="o">.</span><span class="n">cuestionarios</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                                               <span class="n">cuestionario__informante__tipo</span><span class="o">=</span><span class="s">u&#39;EstudianteIdiomas&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">secciones</span> <span class="o">=</span> <span class="n">Seccion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cuestionario__in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="o">.</span><span class="n">cuestionarios</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                                               <span class="n">cuestionario__informante__tipo</span><span class="o">=</span><span class="s">u&#39;Estudiante&#39;</span><span class="p">)</span>
        <span class="c"># Para asegurar que se tomen unicamente preguntas que representen indicadores además</span>
        <span class="c"># Se seleccionan solo ids para poder comparar</span>
        <span class="n">indicadores</span><span class="o">=</span><span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">seccion__in</span><span class="o">=</span><span class="n">secciones</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">tipo__tipo</span><span class="o">=</span><span class="s">u&#39;SeleccionUnica&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">conteo_ms</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="c"># Unica diferencia con respecto al metodo &#39;por_carrera&#39;</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__docente__id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="c"># Recordatorio: &#39;pregunta&#39; en Contestacion es int no de tipo Pregunta</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">MS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_s</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="c"># Unica diferencia con respecto al metodo &#39;por_carrera&#39;</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__docente__id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_ps</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="c"># Unica diferencia con respecto al metodo &#39;por_carrera&#39;</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__docente__id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">PS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_ins</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="c"># Unica diferencia con respecto al metodo &#39;por_carrera&#39;</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__docente__id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">INS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indicadores</span><span class="p">:</span>
            <span class="n">conteo</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="c"># Se intercambia por el objeto completo, por versatilidad</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_s</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ps</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ins</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">grado</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MS&#39;</span><span class="p">,</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;PS&#39;</span><span class="p">,</span><span class="s">&#39;INS&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">grado</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">conteo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">conteos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conteo</span><span class="p">)</span>
            <span class="n">totales</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">grado</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MS&#39;</span><span class="p">,</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;PS&#39;</span><span class="p">,</span><span class="s">&#39;INS&#39;</span><span class="p">):</span>
                <span class="n">totales</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteos</span><span class="p">])</span>
            <span class="n">universo</span> <span class="o">=</span> <span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="c"># Unica diferencia con respecto al método &#39;por_carrera&#39;</span>
                <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__docente__id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
            <span class="n">totales</span><span class="p">[</span><span class="s">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universo</span>
            <span class="n">porcentajes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">grado</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MS&#39;</span><span class="p">,</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;PS&#39;</span><span class="p">,</span><span class="s">&#39;INS&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">universo</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">numero</span>  <span class="o">=</span> <span class="n">totales</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">universo</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">numero</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">porcentajes</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">=</span> <span class="n">numero</span>
            <span class="n">porcentajes</span><span class="p">[</span><span class="s">&#39;MSS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">porcentajes</span><span class="p">[</span><span class="s">&#39;MS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">porcentajes</span><span class="p">[</span><span class="s">&#39;S&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">conteos</span><span class="o">=</span><span class="n">conteos</span><span class="p">,</span> <span class="n">totales</span><span class="o">=</span><span class="n">totales</span><span class="p">,</span> <span class="n">porcentajes</span><span class="o">=</span><span class="n">porcentajes</span><span class="p">)</span>


    <span class="c"># TODO: Usar carrera_id en vez de nombre_carrera?</span>
    <span class="k">def</span> <span class="nf">por_carrera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">):</span>
        <span class="c"># Todas las Secciones de todos los cuestionarios que pertenecen al periodo de evaluación establecido</span>
        <span class="k">if</span> <span class="n">siglas_area</span> <span class="o">==</span> <span class="s">u&#39;ACE&#39;</span><span class="p">:</span>
            <span class="n">secciones</span> <span class="o">=</span> <span class="n">Seccion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cuestionario__in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="o">.</span><span class="n">cuestionarios</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                                               <span class="n">cuestionario__informante__tipo</span><span class="o">=</span><span class="s">u&#39;EstudianteIdiomas&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">secciones</span> <span class="o">=</span> <span class="n">Seccion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cuestionario__in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="o">.</span><span class="n">cuestionarios</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                                               <span class="n">cuestionario__informante__tipo</span><span class="o">=</span><span class="s">u&#39;Estudiante&#39;</span><span class="p">)</span>
        <span class="c"># Para asegurar que se tomen unicamente preguntas que representen indicadores ademas</span>
        <span class="c"># Se seleccionan solo ids para poder comparar</span>
        <span class="n">indicadores</span><span class="o">=</span><span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">seccion__in</span><span class="o">=</span><span class="n">secciones</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">tipo__tipo</span><span class="o">=</span><span class="s">u&#39;SeleccionUnica&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">conteo_ms</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">MS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_s</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_ps</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">PS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_ins</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">INS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indicadores</span><span class="p">:</span>
            <span class="n">conteo</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="c"># Se intercambia por el objeto completo por versatilidad</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_s</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ps</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ins</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">grado</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MS&#39;</span><span class="p">,</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;PS&#39;</span><span class="p">,</span><span class="s">&#39;INS&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">grado</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">conteo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">conteos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conteo</span><span class="p">)</span>
            <span class="n">totales</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">grado</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MS&#39;</span><span class="p">,</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;PS&#39;</span><span class="p">,</span><span class="s">&#39;INS&#39;</span><span class="p">):</span>
                <span class="n">totales</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteos</span><span class="p">])</span>
            <span class="n">universo</span> <span class="o">=</span> <span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
            <span class="n">totales</span><span class="p">[</span><span class="s">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universo</span>
            <span class="n">porcentajes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">grado</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MS&#39;</span><span class="p">,</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;PS&#39;</span><span class="p">,</span><span class="s">&#39;INS&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">universo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">numero</span>  <span class="o">=</span> <span class="n">totales</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">universo</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">numero</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">porcentajes</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">=</span> <span class="n">numero</span>
            <span class="n">porcentajes</span><span class="p">[</span><span class="s">&#39;MSS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">porcentajes</span><span class="p">[</span><span class="s">&#39;MS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">porcentajes</span><span class="p">[</span><span class="s">&#39;S&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">conteos</span><span class="o">=</span><span class="n">conteos</span><span class="p">,</span> <span class="n">totales</span><span class="o">=</span><span class="n">totales</span><span class="p">,</span> <span class="n">porcentajes</span><span class="o">=</span><span class="n">porcentajes</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">por_campos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">,</span> <span class="n">id_seccion</span><span class="p">):</span>
        <span class="c"># @param id_seccion representa el campo del cuestionario. Seccion = Campo</span>
        <span class="k">if</span> <span class="n">id_seccion</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="c"># La sección especcífica del cuestionario (por Área) que corresponde</span>
        <span class="c"># ya se determina en la vista anterior</span>
        <span class="n">seccion</span> <span class="o">=</span> <span class="n">Seccion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_seccion</span><span class="p">)</span>
        <span class="n">logg</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Campo Seccion: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">seccion</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">seccion</span><span class="p">))</span>
        <span class="c"># Se tratan unicamente preguntas abiertas</span>
        <span class="k">if</span> <span class="n">seccion</span><span class="o">.</span><span class="n">orden</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">por_otros_aspectos</span><span class="p">(</span><span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">,</span> <span class="n">seccion</span><span class="p">)</span>
        <span class="c"># Para asegurar que se tomen unicamente preguntas que representen indicadores además</span>
        <span class="c"># de que pertenezcan únicamente al campo (sección) especificado.</span>
        <span class="c"># Se seleccionan solo ids para poder comparar luego</span>
        <span class="n">indicadores</span><span class="o">=</span><span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">seccion</span><span class="o">=</span><span class="n">seccion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">tipo__tipo</span><span class="o">=</span><span class="s">u&#39;SeleccionUnica&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">conteo_ms</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">MS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_s</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_ps</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">PS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_ins</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">INS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indicadores</span><span class="p">:</span>
            <span class="n">conteo</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="c"># Se intercambia por el objeto completo por versatilidad</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_s</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ps</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ins</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">grado</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MS&#39;</span><span class="p">,</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;PS&#39;</span><span class="p">,</span><span class="s">&#39;INS&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">grado</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">conteo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">conteos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conteo</span><span class="p">)</span>
            <span class="n">totales</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">grado</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MS&#39;</span><span class="p">,</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;PS&#39;</span><span class="p">,</span><span class="s">&#39;INS&#39;</span><span class="p">):</span>
                <span class="n">totales</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteos</span><span class="p">])</span>
            <span class="n">universo</span> <span class="o">=</span> <span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
            <span class="n">totales</span><span class="p">[</span><span class="s">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universo</span>
            <span class="n">porcentajes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">grado</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MS&#39;</span><span class="p">,</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;PS&#39;</span><span class="p">,</span><span class="s">&#39;INS&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">universo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">numero</span>  <span class="o">=</span> <span class="n">totales</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">universo</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">numero</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">porcentajes</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">=</span> <span class="n">numero</span>
            <span class="n">porcentajes</span><span class="p">[</span><span class="s">&#39;MSS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">porcentajes</span><span class="p">[</span><span class="s">&#39;MS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">porcentajes</span><span class="p">[</span><span class="s">&#39;S&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">conteos</span><span class="o">=</span><span class="n">conteos</span><span class="p">,</span> <span class="n">totales</span><span class="o">=</span><span class="n">totales</span><span class="p">,</span> <span class="n">porcentajes</span><span class="o">=</span><span class="n">porcentajes</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">por_otros_aspectos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">,</span> <span class="n">seccion</span><span class="p">):</span>
        <span class="n">indicadores</span><span class="o">=</span><span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">seccion</span><span class="o">=</span><span class="n">seccion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">tipo__tipo</span><span class="o">=</span><span class="s">u&#39;Ensayo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">conteo</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">,</span><span class="s">&#39;respuesta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
            <span class="n">frecuencia</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="c"># Para acceder a los datos del objeto pregunta en el template</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo</span><span class="p">:</span>
            <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">conteo</span>

    <span class="k">def</span> <span class="nf">por_indicador</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">,</span> <span class="n">id_pregunta</span> <span class="p">):</span>
        <span class="c"># @param id_pregunta representa el indicador del campo del cuestionario. Pregunta = Indicador</span>
        <span class="c"># La pregunta especcífica del cuestionario (por Área) que corresponde</span>
        <span class="c"># ya se determina en la vista anterior</span>
        <span class="c"># Se selecciona unicamente el id para la comparación posterior</span>
        <span class="n">indicadores</span> <span class="o">=</span> <span class="p">(</span><span class="n">id_pregunta</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">conteo_ms</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">MS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_s</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_ps</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">PS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_ins</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">INS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indicadores</span><span class="p">:</span>
            <span class="n">conteo</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="c"># Se intercambia por el objeto completo por versatilidad</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_s</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ps</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ins</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">grado</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MS&#39;</span><span class="p">,</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;PS&#39;</span><span class="p">,</span><span class="s">&#39;INS&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">grado</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">conteo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">conteos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conteo</span><span class="p">)</span>
            <span class="n">totales</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">grado</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MS&#39;</span><span class="p">,</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;PS&#39;</span><span class="p">,</span><span class="s">&#39;INS&#39;</span><span class="p">):</span>
                <span class="n">totales</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteos</span><span class="p">])</span>
            <span class="n">universo</span> <span class="o">=</span> <span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
            <span class="n">totales</span><span class="p">[</span><span class="s">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universo</span>
            <span class="n">porcentajes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">grado</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MS&#39;</span><span class="p">,</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;PS&#39;</span><span class="p">,</span><span class="s">&#39;INS&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">universo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">numero</span> <span class="o">=</span> <span class="n">totales</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">universo</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">numero</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">porcentajes</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">=</span> <span class="n">numero</span>
            <span class="n">porcentajes</span><span class="p">[</span><span class="s">&#39;MSS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">porcentajes</span><span class="p">[</span><span class="s">&#39;MS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">porcentajes</span><span class="p">[</span><span class="s">&#39;S&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">conteos</span><span class="o">=</span><span class="n">conteos</span><span class="p">,</span> <span class="n">totales</span><span class="o">=</span><span class="n">totales</span><span class="p">,</span> <span class="n">porcentajes</span><span class="o">=</span><span class="n">porcentajes</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">mayor_satisfaccion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">):</span>
        <span class="c"># Todas las Secciones de todos los cuestionarios que pertenecen al periodo de evaluación establecido</span>
        <span class="k">if</span> <span class="n">siglas_area</span> <span class="o">==</span> <span class="s">u&#39;ACE&#39;</span><span class="p">:</span>
            <span class="n">secciones</span> <span class="o">=</span> <span class="n">Seccion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cuestionario__in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="o">.</span><span class="n">cuestionarios</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                                               <span class="n">cuestionario__informante__tipo</span><span class="o">=</span><span class="s">u&#39;EstudianteIdiomas&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">secciones</span> <span class="o">=</span> <span class="n">Seccion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cuestionario__in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="o">.</span><span class="n">cuestionarios</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                                               <span class="n">cuestionario__informante__tipo</span><span class="o">=</span><span class="s">u&#39;Estudiante&#39;</span><span class="p">)</span>
        <span class="c"># Para asegurar que se tomen unicamente preguntas que representen indicadores además</span>
        <span class="c"># Se seleccionan solo ids para poder comparar</span>
        <span class="n">indicadores</span><span class="o">=</span><span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">seccion__in</span><span class="o">=</span><span class="n">secciones</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">tipo__tipo</span><span class="o">=</span><span class="s">u&#39;SeleccionUnica&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">conteo_ms</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">MS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_s</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_ps</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">PS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_ins</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">INS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Se contabiliza por cada pregunta</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indicadores</span><span class="p">:</span>
            <span class="n">conteo</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="c"># Se intercambia por el objeto completo por versatilidad</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_s</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ps</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ins</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">grado</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MS&#39;</span><span class="p">,</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;PS&#39;</span><span class="p">,</span><span class="s">&#39;INS&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">grado</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">conteo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">conteos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conteo</span><span class="p">)</span>
        <span class="c"># Ordenar de mayor a menor por &#39;MS&#39; luego por &#39;S&#39;</span>
        <span class="n">conteos</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">:</span> <span class="o">-</span><span class="nb">cmp</span><span class="p">(</span><span class="n">c1</span><span class="p">[</span><span class="s">&#39;MS&#39;</span><span class="p">],</span><span class="n">c2</span><span class="p">[</span><span class="s">&#39;MS&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="o">-</span><span class="nb">cmp</span><span class="p">(</span><span class="n">c1</span><span class="p">[</span><span class="s">&#39;S&#39;</span><span class="p">],</span><span class="n">c2</span><span class="p">[</span><span class="s">&#39;S&#39;</span><span class="p">]</span> <span class="p">))</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">conteos</span><span class="o">=</span><span class="n">conteos</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">totales</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">porcentajes</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">mayor_insatisfaccion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">):</span>
        <span class="c"># Todas las Secciones de todos los cuestionarios que pertenecen al periodo de evaluación establecido</span>
        <span class="k">if</span> <span class="n">siglas_area</span> <span class="o">==</span> <span class="s">u&#39;ACE&#39;</span><span class="p">:</span>
            <span class="n">secciones</span> <span class="o">=</span> <span class="n">Seccion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cuestionario__in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="o">.</span><span class="n">cuestionarios</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                                               <span class="n">cuestionario__informante__tipo</span><span class="o">=</span><span class="s">u&#39;EstudianteIdiomas&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">secciones</span> <span class="o">=</span> <span class="n">Seccion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cuestionario__in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="o">.</span><span class="n">cuestionarios</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                                               <span class="n">cuestionario__informante__tipo</span><span class="o">=</span><span class="s">u&#39;Estudiante&#39;</span><span class="p">)</span>
        <span class="c"># Para asegurar que se tomen unicamente preguntas que representen indicadores además</span>
        <span class="c"># Se seleccionan solo ids para poder comparar</span>
        <span class="n">indicadores</span><span class="o">=</span><span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">seccion__in</span><span class="o">=</span><span class="n">secciones</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">tipo__tipo</span><span class="o">=</span><span class="s">u&#39;SeleccionUnica&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">conteos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contabilizar</span><span class="p">(</span><span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">,</span> <span class="n">indicadores</span><span class="p">)</span>
        <span class="c"># Ordenar de mayor a menor por &#39;INS&#39; luego por &#39;PS&#39;</span>
        <span class="n">conteos</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">:</span> <span class="o">-</span><span class="nb">cmp</span><span class="p">(</span><span class="n">c1</span><span class="p">[</span><span class="s">&#39;INS&#39;</span><span class="p">],</span> <span class="n">c2</span><span class="p">[</span><span class="s">&#39;INS&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="o">-</span><span class="nb">cmp</span><span class="p">(</span><span class="n">c1</span><span class="p">[</span><span class="s">&#39;PS&#39;</span><span class="p">],</span> <span class="n">c2</span><span class="p">[</span><span class="s">&#39;PS&#39;</span><span class="p">]</span> <span class="p">))</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">conteos</span><span class="o">=</span><span class="n">conteos</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">totales</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">porcentajes</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_contabilizar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">siglas_area</span><span class="p">,</span> <span class="n">nombre_carrera</span><span class="p">,</span> <span class="n">indicadores</span><span class="o">=</span><span class="p">[],</span> <span class="n">id_docente</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param indicadores: lista de ids de pregunta que se involucran en el conteo</span>
<span class="sd">        @param id_docente: para el caso único en el que no se contabiliza en toda la carrera</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conteo_ms</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">MS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_s</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_ps</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">PS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="n">conteo_ins</span><span class="o">=</span><span class="n">Contestacion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__cuestionario__periodoEvaluacion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periodoEvaluacion</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__cuestionario__periodoEvaluacion__tabulacion__tipo</span><span class="o">=</span><span class="s">&#39;ESE2012&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__area</span><span class="o">=</span><span class="n">siglas_area</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__asignatura__carrera</span><span class="o">=</span><span class="n">nombre_carrera</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">pregunta__in</span><span class="o">=</span><span class="n">indicadores</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">INS</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">&#39;respuesta&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">respuesta</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pregunta&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">id_docente</span><span class="p">:</span>
            <span class="n">conteo_ms</span> <span class="o">=</span> <span class="n">conteo_ms</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__docente__id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">)</span>
            <span class="n">conteo_s</span> <span class="o">=</span> <span class="n">conteo_s</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__docente__id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">)</span>
            <span class="n">conteo_ps</span> <span class="o">=</span> <span class="n">conteo_ps</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__docente__id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">)</span>
            <span class="n">conteo_ins</span> <span class="o">=</span> <span class="n">conteo_ins</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">evaluacion__estudianteAsignaturaDocente__asignaturaDocente__docente__id</span><span class="o">=</span><span class="n">id_docente</span><span class="p">)</span>
        <span class="n">conteos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Se contabiliza por cada pregunta</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indicadores</span><span class="p">:</span>
            <span class="n">conteo</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="c"># Se intercambia por el objeto completo por versatilidad</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_s</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ps</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conteo_ins</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">conteo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="s">&#39;pregunta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pregunta</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">grado</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MS&#39;</span><span class="p">,</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;PS&#39;</span><span class="p">,</span><span class="s">&#39;INS&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">grado</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">conteo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">conteo</span><span class="p">[</span><span class="n">grado</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">conteos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conteo</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">conteos</span>
</pre></div>
</div>
</div>
<div class="section" id="clase-usuario">
<span id="class-usuario"></span><h2>3.27. Clase Usuario<a class="headerlink" href="#clase-usuario" title="Permalink to this headline">¶</a></h2>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Usuario</span><span class="p">(</span><span class="n">User</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perfil de Usuario que podrá pertener a los grupos Estudiante y/o Docente</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cedula</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;15&#39;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">titulo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="s">&#39;100&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_nombres</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span>

    <span class="k">def</span> <span class="nf">set_nombres</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nombres</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">nombres</span>

    <span class="k">def</span> <span class="nf">get_apellidos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span>

    <span class="k">def</span> <span class="nf">set_apellidos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apellidos</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">apellidos</span>

    <span class="k">def</span> <span class="nf">get_abreviatura</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">equivalencias</span> <span class="o">=</span> <span class="p">{</span><span class="s">u&#39;magister&#39;</span><span class="p">:</span><span class="s">u&#39;Mg.&#39;</span><span class="p">,</span> <span class="s">u&#39;magíster&#39;</span><span class="p">:</span><span class="s">u&#39;Mg.&#39;</span><span class="p">,</span> <span class="s">u&#39;ing.&#39;</span><span class="p">:</span><span class="s">u&#39;Ing.&#39;</span><span class="p">,</span> <span class="s">u&#39;ingeniero&#39;</span><span class="p">:</span><span class="s">u&#39;Ing.&#39;</span><span class="p">,</span> <span class="s">u&#39;ingeniera&#39;</span><span class="p">:</span><span class="s">u&#39;Ing.&#39;</span><span class="p">,</span>
                         <span class="s">u&#39;Ing.&#39;</span><span class="p">:</span><span class="s">u&#39;Ing.&#39;</span><span class="p">,</span> <span class="s">u&#39;doctor&#39;</span><span class="p">:</span><span class="s">u&#39;Dr.&#39;</span><span class="p">,</span> <span class="s">u&#39;doctora&#39;</span><span class="p">:</span><span class="s">u&#39;Dra.&#39;</span><span class="p">,</span> <span class="s">u&#39;master&#39;</span><span class="p">:</span><span class="s">u&#39;Ms.&#39;</span><span class="p">,</span>
                         <span class="s">u&#39;mg.&#39;</span><span class="p">:</span><span class="s">u&#39;Mg.&#39;</span><span class="p">,</span> <span class="s">u&#39;licenciado&#39;</span><span class="p">:</span><span class="s">u&#39;Lic.&#39;</span><span class="p">,</span> <span class="s">u&#39;licenciada&#39;</span><span class="p">:</span><span class="s">u&#39;Lic.&#39;</span><span class="p">,</span> <span class="s">u&#39;economista&#39;</span><span class="p">:</span><span class="s">u&#39;Eco.&#39;</span><span class="p">,</span> <span class="s">u&#39;eco.&#39;</span><span class="p">:</span><span class="s">u&#39;Eco.&#39;</span><span class="p">,</span> <span class="s">u&#39;medico&#39;</span><span class="p">:</span><span class="s">u&#39;Dr.&#39;</span><span class="p">,</span>
                         <span class="s">u&#39;dra.&#39;</span><span class="p">:</span><span class="s">u&#39;Dra.&#39;</span><span class="p">,</span><span class="s">u&#39;dr.&#39;</span><span class="p">:</span><span class="s">u&#39;Dr.&#39;</span><span class="p">,</span><span class="s">u&#39;lic.&#39;</span><span class="p">:</span><span class="s">u&#39;Lic.&#39;</span><span class="p">,</span> <span class="s">u&#39;licdo.&#39;</span><span class="p">:</span><span class="s">u&#39;Lic.&#39;</span><span class="p">,</span><span class="s">u&#39;ing.&#39;</span><span class="p">:</span><span class="s">u&#39;Ing.&#39;</span><span class="p">,</span> <span class="s">u&#39;phd.&#39;</span><span class="p">:</span><span class="s">u&#39;Phd.&#39;</span><span class="p">,</span><span class="s">u&#39;médico&#39;</span><span class="p">:</span><span class="s">u&#39;Dr.&#39;</span><span class="p">,</span>
                         <span class="s">u&#39;odontólogo&#39;</span><span class="p">:</span> <span class="s">u&#39;Odont.&#39;</span><span class="p">,</span> <span class="s">u&#39;odontóloga&#39;</span><span class="p">:</span> <span class="s">u&#39;Odont.&#39;</span><span class="p">,</span> <span class="s">u&#39;odontologo&#39;</span><span class="p">:</span> <span class="s">u&#39;Odont.&#39;</span><span class="p">,</span> <span class="s">u&#39;odontologa&#39;</span><span class="p">:</span> <span class="s">u&#39;Odont.&#39;</span><span class="p">,</span>
                         <span class="s">u&#39;esp.&#39;</span><span class="p">:</span><span class="s">u&#39;Esp.&#39;</span><span class="p">,</span> <span class="s">u&#39;Especialista&#39;</span><span class="p">:</span><span class="s">u&#39;Esp.&#39;</span>
                         <span class="p">}</span>
        <span class="n">palabras</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">titulo</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">titulo</span> <span class="k">else</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">palabras</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">equivalencias</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">equivalencias</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span>

    <span class="n">nombres</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_nombres</span><span class="p">,</span> <span class="n">set_nombres</span><span class="p">)</span>
    <span class="n">apellidos</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_apellidos</span><span class="p">,</span> <span class="n">set_apellidos</span><span class="p">)</span>
    <span class="n">abreviatura</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_abreviatura</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&#39;{0} {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cedula</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_name</span><span class="p">());</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Nota: una nota cualquiera
.. <a href="#id1"><span class="problematic" id="id2">|enlace|</span></a> replace:: esta frase reeplaza
.. _Python: <a class="reference external" href="http://www.python.org/">http://www.python.org/</a>
palabra <a href="#id5"><span class="problematic" id="id6">Python_</span></a>
palabra  <a href="#id3"><span class="problematic" id="id4">|enlace|</span></a></p>
</div>
</div>
</div>


</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Jhymer Martínez.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2b1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>